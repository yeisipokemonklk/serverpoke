{
  "version": 3,
  "sources": ["../../../sim/team-validator.ts"],
  "sourcesContent": ["/**\r\n * Team Validator\r\n * Pokemon Showdown - http://pokemonshowdown.com/\r\n *\r\n * Handles team validation, and specifically learnset checking.\r\n *\r\n * @license MIT\r\n */\r\n\r\nimport {Dex, toID} from './dex';\r\nimport {Utils} from '../lib';\r\nimport {Tags} from '../data/tags';\r\nimport {Teams} from './teams';\r\nimport {PRNG} from './prng';\r\n\r\n/**\r\n * Describes a possible way to get a pokemon. Is not exhaustive!\r\n * sourcesBefore covers all sources that do not have exclusive\r\n * moves (like catching wild pokemon).\r\n *\r\n * First character is a generation number, 1-8.\r\n * Second character is a source ID, one of:\r\n *\r\n * - E = egg, 3rd char+ is the father in gen 2-5, empty in gen 6-7\r\n *   because egg moves aren't restricted to fathers anymore\r\n * - S = event, 3rd char+ is the index in .eventData\r\n * - D = Dream World, only 5D is valid\r\n * - V = Virtual Console or Let's Go transfer, only 7V/8V is valid\r\n *\r\n * Designed to match MoveSource where possible.\r\n */\r\nexport type PokemonSource = string;\r\n\r\n/**\r\n * Represents a set of possible ways to get a Pok\u00E9mon with a given\r\n * set.\r\n *\r\n * `new PokemonSources()` creates an empty set;\r\n * `new PokemonSources(dex.gen)` allows all Pokemon.\r\n *\r\n * The set mainly stored as an Array `sources`, but for sets that\r\n * could be sourced from anywhere (for instance, TM moves), we\r\n * instead just set `sourcesBefore` to a number meaning \"any\r\n * source at or before this gen is possible.\"\r\n *\r\n * In other words, this variable represents the set of all\r\n * sources in `sources`, union all sources at or before\r\n * gen `sourcesBefore`.\r\n */\r\nexport class PokemonSources {\r\n\t/**\r\n\t * A set of specific possible PokemonSources; implemented as\r\n\t * an Array rather than a Set for perf reasons.\r\n\t */\r\n\tsources: PokemonSource[];\r\n\t/**\r\n\t * if nonzero: the set also contains all possible sources from\r\n\t * this gen and earlier.\r\n\t */\r\n\tsourcesBefore: number;\r\n\t/**\r\n\t * the set requires sources from this gen or later\r\n\t * this should be unchanged from the format's minimum past gen\r\n\t * (3 in modern games, 6 if pentagon is required, etc)\r\n\t */\r\n\tsourcesAfter: number;\r\n\tisHidden: boolean | null;\r\n\t/**\r\n\t * `limitedEggMoves` is a list of moves that can only be obtained from an\r\n\t * egg with another father in gen 2-5. If there are multiple such moves,\r\n\t * potential fathers need to be checked to see if they can actually\r\n\t * learn the move combination in question.\r\n\t *\r\n\t * `null` = the current move is definitely not a limited egg move\r\n\t *\r\n\t * `undefined` = the current move may or may not be a limited egg move\r\n\t */\r\n\tlimitedEggMoves?: ID[] | null;\r\n\t/**\r\n\t * Moves that should be in limitedEggMoves that would otherwise be skipped\r\n\t * because they can be learned universally in a past generation\r\n\t */\r\n\tpossiblyLimitedEggMoves?: ID[] | null;\r\n\t/**\r\n\t * Moves that should be in limitedEggMoves that would otherwise be skipped\r\n\t * because they can be learned via Gen 1-2 tradeback\r\n\t */\r\n\ttradebackLimitedEggMoves?: ID[] | null;\r\n\t/**\r\n\t * Tracks level up egg moves for female-only Pokemon\r\n\t */\r\n\tlevelUpEggMoves?: ID[] | null;\r\n\t/**\r\n\t * Moves that can be learned via Pomeg glitch and does not require a\r\n\t * particular parent to learn\r\n\t */\r\n\tpomegEggMoves?: ID[] | null;\r\n\t/**\r\n\t * Event egg source that may be used with the Pomeg glitch\r\n\t *\r\n\t * `null` = definitely not an event egg that can be used with the Pomeg glitch\r\n\t */\r\n\tpomegEventEgg?: string | null;\r\n\t/**\r\n\t * Some Pokemon evolve by having a move in their learnset (like Piloswine\r\n\t * with Ancient Power). These can only carry three other moves from their\r\n\t * prevo, because the fourth move must be the evo move. This restriction\r\n\t * doesn't apply to gen 6+ eggs, which can get around the restriction with\r\n\t * the relearner.\r\n\t */\r\n\tmoveEvoCarryCount: number;\r\n\r\n\tbabyOnly?: string;\r\n\tsketchMove?: string;\r\n\tdreamWorldMoveCount: number;\r\n\thm?: string;\r\n\tisFromPokemonGo?: boolean;\r\n\tpokemonGoSource?: string;\r\n\trestrictiveMoves?: string[];\r\n\t/** Obscure learn methods */\r\n\trestrictedMove?: ID;\r\n\r\n\tconstructor(sourcesBefore = 0, sourcesAfter = 0) {\r\n\t\tthis.sources = [];\r\n\t\tthis.sourcesBefore = sourcesBefore;\r\n\t\tthis.sourcesAfter = sourcesAfter;\r\n\t\tthis.isHidden = null;\r\n\t\tthis.limitedEggMoves = undefined;\r\n\t\tthis.moveEvoCarryCount = 0;\r\n\t\tthis.dreamWorldMoveCount = 0;\r\n\t}\r\n\tsize() {\r\n\t\tif (this.sourcesBefore) return Infinity;\r\n\t\treturn this.sources.length;\r\n\t}\r\n\tadd(source: PokemonSource, limitedEggMove?: ID | null) {\r\n\t\tif (this.sources[this.sources.length - 1] !== source) this.sources.push(source);\r\n\t\tif (limitedEggMove) {\r\n\t\t\tif (source.substr(0, 3) === '1ET') {\r\n\t\t\t\tthis.tradebackLimitedEggMoves = [limitedEggMove];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (limitedEggMove && this.limitedEggMoves !== null) {\r\n\t\t\tthis.limitedEggMoves = [limitedEggMove];\r\n\t\t} else if (limitedEggMove === null) {\r\n\t\t\tthis.limitedEggMoves = null;\r\n\t\t}\r\n\t}\r\n\taddGen(sourceGen: number) {\r\n\t\tthis.sourcesBefore = Math.max(this.sourcesBefore, sourceGen);\r\n\t\tthis.limitedEggMoves = null;\r\n\t}\r\n\tminSourceGen() {\r\n\t\tif (this.sourcesBefore) return this.sourcesAfter || 1;\r\n\t\tlet min = 10;\r\n\t\tfor (const source of this.sources) {\r\n\t\t\tconst sourceGen = parseInt(source.charAt(0));\r\n\t\t\tif (sourceGen < min) min = sourceGen;\r\n\t\t}\r\n\t\tif (min === 10) return 0;\r\n\t\treturn min;\r\n\t}\r\n\tmaxSourceGen() {\r\n\t\tlet max = this.sourcesBefore;\r\n\t\tfor (const source of this.sources) {\r\n\t\t\tconst sourceGen = parseInt(source.charAt(0));\r\n\t\t\tif (sourceGen > max) max = sourceGen;\r\n\t\t}\r\n\t\treturn max;\r\n\t}\r\n\tintersectWith(other: PokemonSources) {\r\n\t\tif (this.pomegEventEgg && other.pomegEggMoves) {\r\n\t\t\tconst newSources = [];\r\n\t\t\tfor (const source of other.sources) {\r\n\t\t\t\tnewSources.push(source.substr(0, 2) === '3E' ? this.pomegEventEgg : source);\r\n\t\t\t}\r\n\t\t\tother.sources = newSources;\r\n\t\t} else if (other.pomegEventEgg && this.pomegEventEgg !== null) {\r\n\t\t\tconst newSources = [];\r\n\t\t\tfor (const source of this.sources) {\r\n\t\t\t\tnewSources.push(source.substr(0, 2) === '3E' ? other.pomegEventEgg : source);\r\n\t\t\t}\r\n\t\t\tthis.sources = newSources;\r\n\t\t\tthis.pomegEventEgg = other.pomegEventEgg;\r\n\t\t} else if (!other.pomegEggMoves && !other.sourcesBefore) {\r\n\t\t\tthis.pomegEventEgg = null;\r\n\t\t}\r\n\t\tif (other.sourcesBefore || this.sourcesBefore) {\r\n\t\t\t// having sourcesBefore is the equivalent of having everything before that gen\r\n\t\t\t// in sources, so we fill the other array in preparation for intersection\r\n\t\t\tif (other.sourcesBefore > this.sourcesBefore) {\r\n\t\t\t\tfor (const source of this.sources) {\r\n\t\t\t\t\tconst sourceGen = parseInt(source.charAt(0));\r\n\t\t\t\t\tif (sourceGen <= other.sourcesBefore) {\r\n\t\t\t\t\t\tother.sources.push(source);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.sourcesBefore > other.sourcesBefore) {\r\n\t\t\t\tfor (const source of other.sources) {\r\n\t\t\t\t\tconst sourceGen = parseInt(source.charAt(0));\r\n\t\t\t\t\tif (sourceGen <= this.sourcesBefore) {\r\n\t\t\t\t\t\tthis.sources.push(source);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sourcesBefore = Math.min(other.sourcesBefore, this.sourcesBefore);\r\n\t\t}\r\n\t\tif (this.sources.length) {\r\n\t\t\tif (other.sources.length) {\r\n\t\t\t\tconst sourcesSet = new Set(other.sources);\r\n\t\t\t\tconst intersectSources = this.sources.filter(source => sourcesSet.has(source));\r\n\t\t\t\tthis.sources = intersectSources;\r\n\t\t\t} else {\r\n\t\t\t\tthis.sources = [];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (other.restrictedMove && other.restrictedMove !== this.restrictedMove) {\r\n\t\t\tif (this.restrictedMove) {\r\n\t\t\t\t// incompatible\r\n\t\t\t\tthis.sources = [];\r\n\t\t\t\tthis.sourcesBefore = 0;\r\n\t\t\t} else {\r\n\t\t\t\tthis.restrictedMove = other.restrictedMove;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (other.limitedEggMoves) {\r\n\t\t\tif (!this.limitedEggMoves) {\r\n\t\t\t\tthis.limitedEggMoves = other.limitedEggMoves;\r\n\t\t\t} else {\r\n\t\t\t\tthis.limitedEggMoves.push(...other.limitedEggMoves);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (other.possiblyLimitedEggMoves) {\r\n\t\t\tif (!this.possiblyLimitedEggMoves) {\r\n\t\t\t\tthis.possiblyLimitedEggMoves = other.possiblyLimitedEggMoves;\r\n\t\t\t} else {\r\n\t\t\t\tthis.possiblyLimitedEggMoves.push(...other.possiblyLimitedEggMoves);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (other.tradebackLimitedEggMoves) {\r\n\t\t\tif (!this.tradebackLimitedEggMoves) {\r\n\t\t\t\tthis.tradebackLimitedEggMoves = other.tradebackLimitedEggMoves;\r\n\t\t\t} else {\r\n\t\t\t\tthis.tradebackLimitedEggMoves.push(...other.tradebackLimitedEggMoves);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (other.levelUpEggMoves) {\r\n\t\t\tif (!this.levelUpEggMoves) {\r\n\t\t\t\tthis.levelUpEggMoves = other.levelUpEggMoves;\r\n\t\t\t} else {\r\n\t\t\t\tthis.levelUpEggMoves.push(...other.levelUpEggMoves);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (other.pomegEggMoves) {\r\n\t\t\tif (!this.pomegEggMoves) {\r\n\t\t\t\tthis.pomegEggMoves = other.pomegEggMoves;\r\n\t\t\t} else {\r\n\t\t\t\tthis.pomegEggMoves.push(...other.pomegEggMoves);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.possiblyLimitedEggMoves && !this.sourcesBefore) {\r\n\t\t\tconst eggSources = this.sources.filter(source => source.charAt(1) === 'E');\r\n\t\t\tlet minEggGen = parseInt(eggSources[0]);\r\n\t\t\tfor (const source of eggSources) {\r\n\t\t\t\tminEggGen = Math.min(minEggGen, parseInt(source.charAt(0)));\r\n\t\t\t}\r\n\t\t\tif (minEggGen) {\r\n\t\t\t\tfor (const eggMoveAndGen of this.possiblyLimitedEggMoves) {\r\n\t\t\t\t\tif (!this.limitedEggMoves) this.limitedEggMoves = [];\r\n\t\t\t\t\tif (parseInt(eggMoveAndGen.charAt(0)) < minEggGen) {\r\n\t\t\t\t\t\tconst eggMove = toID(eggMoveAndGen.substr(1));\r\n\t\t\t\t\t\tif (!this.limitedEggMoves.includes(eggMove)) this.limitedEggMoves.push(eggMove);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet eggTradebackLegal = false;\r\n\t\tfor (const source of this.sources) {\r\n\t\t\tif (source.substr(0, 3) === '1ET') {\r\n\t\t\t\teggTradebackLegal = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!eggTradebackLegal && this.tradebackLimitedEggMoves) {\r\n\t\t\tfor (const eggMove of this.tradebackLimitedEggMoves) {\r\n\t\t\t\tif (!this.limitedEggMoves) this.limitedEggMoves = [];\r\n\t\t\t\tif (!this.limitedEggMoves.includes(eggMove)) this.limitedEggMoves.push(eggMove);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.moveEvoCarryCount += other.moveEvoCarryCount;\r\n\t\tthis.dreamWorldMoveCount += other.dreamWorldMoveCount;\r\n\t\tif (other.sourcesAfter > this.sourcesAfter) this.sourcesAfter = other.sourcesAfter;\r\n\t\tif (other.isHidden) this.isHidden = true;\r\n\t}\r\n}\r\n\r\nexport class TeamValidator {\r\n\treadonly format: Format;\r\n\treadonly dex: ModdedDex;\r\n\treadonly gen: number;\r\n\treadonly ruleTable: import('./dex-formats').RuleTable;\r\n\treadonly minSourceGen: number;\r\n\r\n\treadonly toID: (str: any) => ID;\r\n\tconstructor(format: string | Format, dex = Dex) {\r\n\t\tthis.format = dex.formats.get(format);\r\n\t\tthis.dex = dex.forFormat(this.format);\r\n\t\tthis.gen = this.dex.gen;\r\n\t\tthis.ruleTable = this.dex.formats.getRuleTable(this.format);\r\n\r\n\t\tthis.minSourceGen = this.ruleTable.minSourceGen;\r\n\r\n\t\tthis.toID = toID;\r\n\t}\r\n\r\n\tvalidateTeam(\r\n\t\tteam: PokemonSet[] | null,\r\n\t\toptions: {\r\n\t\t\tremoveNicknames?: boolean,\r\n\t\t\tskipSets?: {[name: string]: {[key: string]: boolean}},\r\n\t\t} = {}\r\n\t): string[] | null {\r\n\t\tif (team && this.format.validateTeam) {\r\n\t\t\treturn this.format.validateTeam.call(this, team, options) || null;\r\n\t\t}\r\n\t\treturn this.baseValidateTeam(team, options);\r\n\t}\r\n\r\n\tbaseValidateTeam(\r\n\t\tteam: PokemonSet[] | null,\r\n\t\toptions: {\r\n\t\t\tremoveNicknames?: boolean,\r\n\t\t\tskipSets?: {[name: string]: {[key: string]: boolean}},\r\n\t\t} = {}\r\n\t): string[] | null {\r\n\t\tconst format = this.format;\r\n\t\tconst dex = this.dex;\r\n\r\n\t\tlet problems: string[] = [];\r\n\t\tconst ruleTable = this.ruleTable;\r\n\t\tif (format.team) {\r\n\t\t\tif (team) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`This format doesn't let you use your own team.`,\r\n\t\t\t\t\t`If you're not using a custom client, please report this as a bug. If you are, remember to use \\`/utm null\\` before starting a game in this format.`,\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\tconst testTeamSeed = PRNG.generateSeed();\r\n\t\t\ttry {\r\n\t\t\t\tconst testTeamGenerator = Teams.getGenerator(format, testTeamSeed);\r\n\t\t\t\ttestTeamGenerator.getTeam(options); // Throws error if generation fails\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${format.name}'s team generator (${format.team}) failed using these rules and seed (${testTeamSeed}):-`,\r\n\t\t\t\t\t`${e}`,\r\n\t\t\t\t];\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (!team) {\r\n\t\t\treturn [\r\n\t\t\t\t`This format requires you to use your own team.`,\r\n\t\t\t\t`If you're not using a custom client, please report this as a bug.`,\r\n\t\t\t];\r\n\t\t}\r\n\t\tif (!Array.isArray(team)) {\r\n\t\t\tthrow new Error(`Invalid team data`);\r\n\t\t}\r\n\r\n\t\tif (team.length < ruleTable.minTeamSize) {\r\n\t\t\tproblems.push(`You must bring at least ${ruleTable.minTeamSize} Pok\\u00E9mon (your team has ${team.length}).`);\r\n\t\t}\r\n\t\tif (team.length > ruleTable.maxTeamSize) {\r\n\t\t\treturn [`You may only bring up to ${ruleTable.maxTeamSize} Pok\\u00E9mon (your team has ${team.length}).`];\r\n\t\t}\r\n\r\n\t\t// A limit is imposed here to prevent too much engine strain or\r\n\t\t// too much layout deformation - to be exact, this is the limit\r\n\t\t// allowed in Custom Game.\r\n\t\tif (team.length > 24) {\r\n\t\t\tproblems.push(`Your team has more than than 24 Pok\\u00E9mon, which the simulator can't handle.`);\r\n\t\t\treturn problems;\r\n\t\t}\r\n\r\n\t\tconst teamHas: {[k: string]: number} = {};\r\n\t\tlet lgpeStarterCount = 0;\r\n\t\tlet deoxysType;\r\n\t\tfor (const set of team) {\r\n\t\t\tif (!set) return [`You sent invalid team data. If you're not using a custom client, please report this as a bug.`];\r\n\r\n\t\t\tlet setProblems: string[] | null = null;\r\n\t\t\tif (options.skipSets && options.skipSets[set.name]) {\r\n\t\t\t\tfor (const i in options.skipSets[set.name]) {\r\n\t\t\t\t\tteamHas[i] = (teamHas[i] || 0) + 1;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tsetProblems = (format.validateSet || this.validateSet).call(this, set, teamHas);\r\n\t\t\t}\r\n\r\n\t\t\tif (set.species === 'Pikachu-Starter' || set.species === 'Eevee-Starter') {\r\n\t\t\t\tlgpeStarterCount++;\r\n\t\t\t\tif (lgpeStarterCount === 2 && ruleTable.isBanned('nonexistent')) {\r\n\t\t\t\t\tproblems.push(`You can only have one of Pikachu-Starter or Eevee-Starter on a team.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (dex.gen === 3 && set.species.startsWith('Deoxys')) {\r\n\t\t\t\tif (!deoxysType) {\r\n\t\t\t\t\tdeoxysType = set.species;\r\n\t\t\t\t} else if (deoxysType !== set.species && ruleTable.isBanned('nonexistent')) {\r\n\t\t\t\t\treturn [\r\n\t\t\t\t\t\t`You cannot have more than one type of Deoxys forme.`,\r\n\t\t\t\t\t\t`(Each game in Gen 3 supports only one forme of Deoxys.)`,\r\n\t\t\t\t\t];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (setProblems) {\r\n\t\t\t\tproblems = problems.concat(setProblems);\r\n\t\t\t}\r\n\t\t\tif (options.removeNicknames) {\r\n\t\t\t\tconst useCrossSpeciesNicknames = format.name.includes('Cross Evolution') || ruleTable.has('franticfusionsmod');\r\n\t\t\t\tconst species = dex.species.get(set.species);\r\n\t\t\t\tlet crossSpecies: Species;\r\n\t\t\t\tif (useCrossSpeciesNicknames && (crossSpecies = dex.species.get(set.name)).exists) {\r\n\t\t\t\t\tset.name = crossSpecies.name;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tset.name = species.baseSpecies;\r\n\t\t\t\t\tif (species.baseSpecies === 'Unown') set.species = 'Unown';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const [rule, source, limit, bans] of ruleTable.complexTeamBans) {\r\n\t\t\tlet count = 0;\r\n\t\t\tfor (const ban of bans) {\r\n\t\t\t\tif (teamHas[ban] > 0) {\r\n\t\t\t\t\tcount += limit ? teamHas[ban] : 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (limit && count > limit) {\r\n\t\t\t\tconst clause = source ? ` by ${source}` : ``;\r\n\t\t\t\tproblems.push(`You are limited to ${limit} of ${rule}${clause}.`);\r\n\t\t\t} else if (!limit && count >= bans.length) {\r\n\t\t\t\tconst clause = source ? ` by ${source}` : ``;\r\n\t\t\t\tproblems.push(`Your team has the combination of ${rule}, which is banned${clause}.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const rule of ruleTable.keys()) {\r\n\t\t\tif ('!+-'.includes(rule.charAt(0))) continue;\r\n\t\t\tconst subformat = dex.formats.get(rule);\r\n\t\t\tif (subformat.onValidateTeam && ruleTable.has(subformat.id)) {\r\n\t\t\t\tproblems = problems.concat(subformat.onValidateTeam.call(this, team, format, teamHas) || []);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (format.onValidateTeam) {\r\n\t\t\tproblems = problems.concat(format.onValidateTeam.call(this, team, format, teamHas) || []);\r\n\t\t}\r\n\r\n\t\tif (!problems.length) return null;\r\n\t\treturn problems;\r\n\t}\r\n\r\n\tgetEventOnlyData(species: Species, noRecurse?: boolean): {species: Species, eventData: EventInfo[]} | null {\r\n\t\tconst dex = this.dex;\r\n\t\tconst learnset = dex.species.getLearnsetData(species.id);\r\n\t\tif (!learnset?.eventOnly) {\r\n\t\t\tif (noRecurse) return null;\r\n\t\t\treturn this.getEventOnlyData(dex.species.get(species.prevo), true);\r\n\t\t}\r\n\r\n\t\tif (!learnset.eventData && species.forme) {\r\n\t\t\treturn this.getEventOnlyData(dex.species.get(species.baseSpecies), true);\r\n\t\t}\r\n\t\tif (!learnset.eventData) {\r\n\t\t\tthrow new Error(`Event-only species ${species.name} has no eventData table`);\r\n\t\t}\r\n\r\n\t\treturn {species, eventData: learnset.eventData};\r\n\t}\r\n\r\n\tgetValidationSpecies(set: PokemonSet): [Species, Species] {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\t\tconst species = dex.species.get(set.species);\r\n\t\tconst item = dex.items.get(set.item);\r\n\t\tconst ability = dex.abilities.get(set.ability);\r\n\r\n\t\tlet outOfBattleSpecies = species;\r\n\t\tlet tierSpecies = species;\r\n\t\tif (ability.id === 'battlebond' && toID(species.baseSpecies) === 'greninja') {\r\n\t\t\toutOfBattleSpecies = dex.species.get('greninjabond');\r\n\t\t\tif (ruleTable.has('obtainableformes')) {\r\n\t\t\t\ttierSpecies = outOfBattleSpecies;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ability.id === 'owntempo' && species.id === 'rockruff') {\r\n\t\t\ttierSpecies = outOfBattleSpecies = dex.species.get('rockruffdusk');\r\n\t\t}\r\n\r\n\t\tif (ruleTable.has('obtainableformes')) {\r\n\t\t\tconst canMegaEvo = dex.gen <= 7 || ruleTable.has('+pokemontag:past');\r\n\t\t\tif (item.megaEvolves === species.name) {\r\n\t\t\t\tif (!item.megaStone) throw new Error(`Item ${item.name} has no base form for mega evolution`);\r\n\t\t\t\ttierSpecies = dex.species.get(item.megaStone);\r\n\t\t\t} else if (item.id === 'redorb' && species.id === 'groudon') {\r\n\t\t\t\ttierSpecies = dex.species.get('Groudon-Primal');\r\n\t\t\t} else if (item.id === 'blueorb' && species.id === 'kyogre') {\r\n\t\t\t\ttierSpecies = dex.species.get('Kyogre-Primal');\r\n\t\t\t} else if (canMegaEvo && species.id === 'rayquaza' && set.moves.map(toID).includes('dragonascent' as ID) &&\r\n\t\t\t\t\t!ruleTable.has('megarayquazaclause')) {\r\n\t\t\t\ttierSpecies = dex.species.get('Rayquaza-Mega');\r\n\t\t\t} else if (item.id === 'rustedsword' && species.id === 'zacian') {\r\n\t\t\t\ttierSpecies = dex.species.get('Zacian-Crowned');\r\n\t\t\t} else if (item.id === 'rustedshield' && species.id === 'zamazenta') {\r\n\t\t\t\ttierSpecies = dex.species.get('Zamazenta-Crowned');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn [outOfBattleSpecies, tierSpecies];\r\n\t}\r\n\r\n\tvalidateSet(set: PokemonSet, teamHas: AnyObject): string[] | null {\r\n\t\tconst format = this.format;\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\tlet problems: string[] = [];\r\n\t\tif (!set) {\r\n\t\t\treturn [`This is not a Pokemon.`];\r\n\t\t}\r\n\r\n\t\tlet species = dex.species.get(set.species);\r\n\t\tset.species = species.name;\r\n\t\t// Backwards compatability with old Gmax format\r\n\t\tif (set.species.toLowerCase().endsWith('-gmax') && this.format.id !== 'gen8megamax') {\r\n\t\t\tset.species = set.species.slice(0, -5);\r\n\t\t\tspecies = dex.species.get(set.species);\r\n\t\t\tif (set.name && set.name.endsWith('-Gmax')) set.name = species.baseSpecies;\r\n\t\t\tset.gigantamax = true;\r\n\t\t}\r\n\t\tif (set.name && set.name.length > 18) {\r\n\t\t\tif (set.name === set.species) {\r\n\t\t\t\tset.name = species.baseSpecies;\r\n\t\t\t} else {\r\n\t\t\t\tproblems.push(`Nickname \"${set.name}\" too long (should be 18 characters or fewer)`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tset.name = dex.getName(set.name);\r\n\t\tlet item = dex.items.get(Utils.getString(set.item));\r\n\t\tset.item = item.name;\r\n\t\tlet ability = dex.abilities.get(Utils.getString(set.ability));\r\n\t\tset.ability = ability.name;\r\n\t\tlet nature = dex.natures.get(Utils.getString(set.nature));\r\n\t\tset.nature = nature.name;\r\n\t\tif (!Array.isArray(set.moves)) set.moves = [];\r\n\r\n\t\tset.name = set.name || species.baseSpecies;\r\n\t\tlet name = set.species;\r\n\t\tif (set.species !== set.name && species.baseSpecies !== set.name) {\r\n\t\t\tname = `${set.name} (${set.species})`;\r\n\t\t}\r\n\r\n\t\tif (!set.teraType && this.gen === 9) {\r\n\t\t\tset.teraType = species.types[0];\r\n\t\t}\r\n\r\n\t\tif (!set.level) set.level = ruleTable.defaultLevel;\r\n\r\n\t\tlet adjustLevel = ruleTable.adjustLevel;\r\n\t\tif (ruleTable.adjustLevelDown && set.level >= ruleTable.adjustLevelDown) {\r\n\t\t\tadjustLevel = ruleTable.adjustLevelDown;\r\n\t\t}\r\n\t\tif (set.level === adjustLevel || (set.level === 100 && ruleTable.maxLevel < 100)) {\r\n\t\t\t// Note that we're temporarily setting level 50 pokemon in VGC to level 100\r\n\t\t\t// This allows e.g. level 50 Hydreigon even though it doesn't evolve until level 64.\r\n\t\t\t// Leveling up can't make an obtainable pokemon unobtainable, so this is safe.\r\n\t\t\t// Just remember to set the level back to adjustLevel at the end of validation.\r\n\t\t\tset.level = ruleTable.maxLevel;\r\n\t\t}\r\n\t\tif (set.level < ruleTable.minLevel) {\r\n\t\t\tproblems.push(`${name} (level ${set.level}) is below the minimum level of ${ruleTable.minLevel}${ruleTable.blame('minlevel')}`);\r\n\t\t}\r\n\t\tif (set.level > ruleTable.maxLevel) {\r\n\t\t\tproblems.push(`${name} (level ${set.level}) is above the maximum level of ${ruleTable.maxLevel}${ruleTable.blame('maxlevel')}`);\r\n\t\t}\r\n\r\n\t\tconst setHas: {[k: string]: true} = {};\r\n\r\n\t\tif (!set.evs) set.evs = TeamValidator.fillStats(null, ruleTable.evLimit === null ? 252 : 0);\r\n\t\tif (!set.ivs) set.ivs = TeamValidator.fillStats(null, 31);\r\n\r\n\t\tif (ruleTable.has('obtainableformes')) {\r\n\t\t\tproblems.push(...this.validateForme(set));\r\n\t\t\tspecies = dex.species.get(set.species);\r\n\t\t}\r\n\t\tconst setSources = this.allSources(species);\r\n\r\n\t\tfor (const [rule] of ruleTable) {\r\n\t\t\tif ('!+-'.includes(rule.charAt(0))) continue;\r\n\t\t\tconst subformat = dex.formats.get(rule);\r\n\t\t\tif (subformat.onChangeSet && ruleTable.has(subformat.id)) {\r\n\t\t\t\tproblems = problems.concat(subformat.onChangeSet.call(this, set, format, setHas, teamHas) || []);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (format.onChangeSet) {\r\n\t\t\tproblems = problems.concat(format.onChangeSet.call(this, set, format, setHas, teamHas) || []);\r\n\t\t}\r\n\r\n\t\t// onChangeSet can modify set.species, set.item, set.ability\r\n\t\tspecies = dex.species.get(set.species);\r\n\t\titem = dex.items.get(set.item);\r\n\t\tability = dex.abilities.get(set.ability);\r\n\r\n\t\tconst [outOfBattleSpecies, tierSpecies] = this.getValidationSpecies(set);\r\n\t\tif (ability.id === 'battlebond' && toID(species.baseSpecies) === 'greninja') {\r\n\t\t\tif (ruleTable.has('obtainablemisc')) {\r\n\t\t\t\tif (set.gender && set.gender !== 'M') {\r\n\t\t\t\t\tproblems.push(`Battle Bond Greninja must be male.`);\r\n\t\t\t\t}\r\n\t\t\t\tset.gender = 'M';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (species.id === 'melmetal' && set.gigantamax && this.dex.species.getLearnsetData(species.id).eventData) {\r\n\t\t\tsetSources.sourcesBefore = 0;\r\n\t\t\tsetSources.sources = ['8S0 melmetal'];\r\n\t\t}\r\n\t\tif (!species.exists) {\r\n\t\t\treturn [`The Pokemon \"${set.species}\" does not exist.`];\r\n\t\t}\r\n\r\n\t\tif (item.id && !item.exists) {\r\n\t\t\treturn [`\"${set.item}\" is an invalid item.`];\r\n\t\t}\r\n\t\tif (ability.id && !ability.exists) {\r\n\t\t\tif (dex.gen < 3) {\r\n\t\t\t\t// gen 1-2 don't have abilities, just silently remove\r\n\t\t\t\tability = dex.abilities.get('');\r\n\t\t\t\tset.ability = '';\r\n\t\t\t} else {\r\n\t\t\t\treturn [`\"${set.ability}\" is an invalid ability.`];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (nature.id && !nature.exists) {\r\n\t\t\tif (dex.gen < 3) {\r\n\t\t\t\t// gen 1-2 don't have natures, just remove them\r\n\t\t\t\tnature = dex.natures.get('');\r\n\t\t\t\tset.nature = '';\r\n\t\t\t} else {\r\n\t\t\t\tproblems.push(`\"${set.nature}\" is an invalid nature.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (set.happiness !== undefined && isNaN(set.happiness)) {\r\n\t\t\tproblems.push(`${name} has an invalid happiness value.`);\r\n\t\t}\r\n\t\tif (set.hpType) {\r\n\t\t\tconst type = dex.types.get(set.hpType);\r\n\t\t\tif (!type.exists || ['normal', 'fairy'].includes(type.id)) {\r\n\t\t\t\tproblems.push(`${name}'s Hidden Power type (${set.hpType}) is invalid.`);\r\n\t\t\t} else {\r\n\t\t\t\tset.hpType = type.name;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (species.forceTeraType) {\r\n\t\t\tset.teraType = species.forceTeraType;\r\n\t\t}\r\n\t\tif (set.teraType) {\r\n\t\t\tconst type = dex.types.get(set.teraType);\r\n\t\t\tif (!type.exists) {\r\n\t\t\t\tproblems.push(`${name}'s Terastal type (${set.teraType}) is invalid.`);\r\n\t\t\t} else {\r\n\t\t\t\tset.teraType = type.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet problem = this.checkSpecies(set, species, tierSpecies, setHas);\r\n\t\tif (problem) problems.push(problem);\r\n\r\n\t\tproblem = this.checkItem(set, item, setHas);\r\n\t\tif (problem) problems.push(problem);\r\n\t\tif (ruleTable.has('obtainablemisc')) {\r\n\t\t\tif (dex.gen === 4 && item.id === 'griseousorb' && species.num !== 487) {\r\n\t\t\t\tproblems.push(`${set.name} cannot hold the Griseous Orb.`, `(In Gen 4, only Giratina could hold the Griseous Orb).`);\r\n\t\t\t}\r\n\t\t\tif (dex.gen <= 1) {\r\n\t\t\t\tif (item.id) {\r\n\t\t\t\t\t// no items allowed\r\n\t\t\t\t\tset.item = '';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!set.ability) set.ability = 'No Ability';\r\n\t\tif (ruleTable.has('obtainableabilities')) {\r\n\t\t\tif (dex.gen <= 2 || dex.currentMod === 'gen7letsgo') {\r\n\t\t\t\tset.ability = 'No Ability';\r\n\t\t\t} else {\r\n\t\t\t\tif (!ability.name || ability.name === 'No Ability') {\r\n\t\t\t\t\tproblems.push(`${name} needs to have an ability.`);\r\n\t\t\t\t} else if (!Object.values(species.abilities).includes(ability.name)) {\r\n\t\t\t\t\tif (tierSpecies.abilities[0] === ability.name) {\r\n\t\t\t\t\t\tset.ability = species.abilities[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tproblems.push(`${name} can't have ${set.ability}.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (ability.name === species.abilities['H']) {\r\n\t\t\t\t\tsetSources.isHidden = true;\r\n\r\n\t\t\t\t\tlet unreleasedHidden = species.unreleasedHidden;\r\n\t\t\t\t\tif (unreleasedHidden === 'Past' && this.minSourceGen < dex.gen) unreleasedHidden = false;\r\n\r\n\t\t\t\t\tif (unreleasedHidden && ruleTable.has('-unreleased')) {\r\n\t\t\t\t\t\tproblems.push(`${name}'s Hidden Ability is unreleased.`);\r\n\t\t\t\t\t} else if (dex.gen === 7 && ['entei', 'suicune', 'raikou'].includes(species.id) && this.minSourceGen > 1) {\r\n\t\t\t\t\t\tproblems.push(`${name}'s Hidden Ability is only available from Virtual Console, which is not allowed in this format.`);\r\n\t\t\t\t\t} else if (dex.gen === 6 && ability.name === 'Symbiosis' &&\r\n\t\t\t\t\t\t(set.species.endsWith('Orange') || set.species.endsWith('White'))) {\r\n\t\t\t\t\t\tproblems.push(`${name}'s Hidden Ability is unreleased for the Orange and White forms.`);\r\n\t\t\t\t\t} else if (dex.gen === 5 && set.level < 10 && (species.maleOnlyHidden || species.gender === 'N')) {\r\n\t\t\t\t\t\tproblems.push(`${name} must be at least level 10 to have a Hidden Ability.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (species.maleOnlyHidden) {\r\n\t\t\t\t\t\tif (set.gender && set.gender !== 'M') {\r\n\t\t\t\t\t\t\tproblems.push(`${name} must be male to have a Hidden Ability.`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tset.gender = 'M';\r\n\t\t\t\t\t\tsetSources.sources = ['5D'];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetSources.isHidden = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tability = dex.abilities.get(set.ability);\r\n\t\tproblem = this.checkAbility(set, ability, setHas);\r\n\t\tif (problem) problems.push(problem);\r\n\r\n\t\tif (!set.nature || dex.gen <= 2) {\r\n\t\t\tset.nature = '';\r\n\t\t}\r\n\t\tnature = dex.natures.get(set.nature);\r\n\t\tproblem = this.checkNature(set, nature, setHas);\r\n\t\tif (problem) problems.push(problem);\r\n\r\n\t\tif (set.moves && Array.isArray(set.moves)) {\r\n\t\t\tset.moves = set.moves.filter(val => val);\r\n\t\t}\r\n\t\tif (!set.moves?.length) {\r\n\t\t\tproblems.push(`${name} has no moves (it must have at least one to be usable).`);\r\n\t\t\tset.moves = [];\r\n\t\t}\r\n\t\tif (set.moves.length > ruleTable.maxMoveCount) {\r\n\t\t\tproblems.push(`${name} has ${set.moves.length} moves, which is more than the limit of ${ruleTable.maxMoveCount}.`);\r\n\t\t\treturn problems;\r\n\t\t}\r\n\r\n\t\tconst moveLegalityWhitelist: {[k: string]: true | undefined} = {};\r\n\t\tfor (const moveName of set.moves) {\r\n\t\t\tif (!moveName) continue;\r\n\t\t\tconst move = dex.moves.get(Utils.getString(moveName));\r\n\t\t\tif (!move.exists) return [`\"${move.name}\" is an invalid move.`];\r\n\r\n\t\t\tproblem = this.checkMove(set, move, setHas);\r\n\t\t\tif (problem) {\r\n\t\t\t\tlet allowedByOM;\r\n\t\t\t\tif (problem.includes('hacking or glitches') &&\r\n\t\t\t\t\truleTable.has('omunobtainablemoves')) {\r\n\t\t\t\t\tproblem = `${name}'s ${problem}`;\r\n\t\t\t\t\tallowedByOM = !this.omCheckCanLearn(move, outOfBattleSpecies, setSources, set, problem);\r\n\t\t\t\t}\r\n\t\t\t\tif (!allowedByOM) {\r\n\t\t\t\t\tproblems.push(problem);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmoveLegalityWhitelist[move.id] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst pokemonGoProblems = this.validatePokemonGo(outOfBattleSpecies, set, setSources);\r\n\t\tconst learnsetSpecies = dex.species.getLearnsetData(outOfBattleSpecies.id);\r\n\t\tlet isFromRBYEncounter = false;\r\n\t\tif (this.gen === 1 && ruleTable.has('obtainablemisc') && !this.ruleTable.has('allowtradeback')) {\r\n\t\t\tlet lowestEncounterLevel;\r\n\t\t\tfor (const encounter of learnsetSpecies.encounters || []) {\r\n\t\t\t\tif (encounter.generation !== 1) continue;\r\n\t\t\t\tif (!encounter.level) continue;\r\n\t\t\t\tif (lowestEncounterLevel && encounter.level > lowestEncounterLevel) continue;\r\n\r\n\t\t\t\tlowestEncounterLevel = encounter.level;\r\n\t\t\t}\r\n\r\n\t\t\tif (lowestEncounterLevel) {\r\n\t\t\t\tif (set.level < lowestEncounterLevel) {\r\n\t\t\t\t\tproblems.push(`${name} is not obtainable at levels below ${lowestEncounterLevel} in Gen 1.`);\r\n\t\t\t\t}\r\n\t\t\t\tisFromRBYEncounter = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!isFromRBYEncounter && ruleTable.has('obtainablemisc')) {\r\n\t\t\t// FIXME: Event pokemon given at a level under what it normally can be attained at gives a false positive\r\n\t\t\tlet evoSpecies = species;\r\n\t\t\twhile (evoSpecies.prevo) {\r\n\t\t\t\tif (set.level < (evoSpecies.evoLevel || 0)) {\r\n\t\t\t\t\tif (!pokemonGoProblems || (pokemonGoProblems && pokemonGoProblems.length)) {\r\n\t\t\t\t\t\tproblems.push(`${name} must be at least level ${evoSpecies.evoLevel} to be evolved.`);\r\n\t\t\t\t\t\tif (pokemonGoProblems && pokemonGoProblems.length) {\r\n\t\t\t\t\t\t\tproblems.push(`It failed to validate as a Pokemon from Pokemon GO because:`);\r\n\t\t\t\t\t\t\tfor (const pokemonGoProblem of pokemonGoProblems) {\r\n\t\t\t\t\t\t\t\tproblems.push(pokemonGoProblem);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// Pokemon from Pokemon GO can be transferred to LGPE\r\n\t\t\t\t\t\tsetSources.isFromPokemonGo = true;\r\n\t\t\t\t\t\tsetSources.sources.push('8V');\r\n\t\t\t\t\t\tsetSources.sourcesBefore = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tevoSpecies = dex.species.get(evoSpecies.prevo);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet moveProblems;\r\n\t\tif (ruleTable.has('obtainablemoves')) {\r\n\t\t\tmoveProblems = this.validateMoves(outOfBattleSpecies, set.moves, setSources, set, name, moveLegalityWhitelist);\r\n\t\t\tproblems.push(...moveProblems);\r\n\t\t}\r\n\r\n\t\tlet eventOnlyData;\r\n\r\n\t\tif (!setSources.sourcesBefore && setSources.sources.length) {\r\n\t\t\tconst legalSources = [];\r\n\t\t\tfor (const source of setSources.sources) {\r\n\t\t\t\tif (this.validateSource(set, source, setSources, outOfBattleSpecies)) continue;\r\n\t\t\t\tlegalSources.push(source);\r\n\t\t\t}\r\n\t\t\tif (legalSources.length) {\r\n\t\t\t\tsetSources.sources = legalSources;\r\n\t\t\t} else {\r\n\t\t\t\tlet nonEggSource = null;\r\n\t\t\t\tfor (const source of setSources.sources) {\r\n\t\t\t\t\tif (source.charAt(1) !== 'E') {\r\n\t\t\t\t\t\tnonEggSource = source;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!nonEggSource) {\r\n\t\t\t\t\t// all egg moves\r\n\t\t\t\t\tproblems.push(`${name} can't get its egg move combination (${setSources.limitedEggMoves!.join(', ')}) from any possible father.`);\r\n\t\t\t\t\tproblems.push(`(Is this incorrect? If so, post the chainbreeding instructions in Bug Reports)`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (species.id === 'mew' && pokemonGoProblems && !pokemonGoProblems.length) {\r\n\t\t\t\t\t\t// Whitelist Pokemon GO Mew, which cannot be sent to Let's Go\r\n\t\t\t\t\t\tsetSources.isFromPokemonGo = true;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (setSources.sources.length > 1) {\r\n\t\t\t\t\t\t\tproblems.push(`${name} has an event-exclusive move that it doesn't qualify for (only one of several ways to get the move will be listed):`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst eventProblems = this.validateSource(\r\n\t\t\t\t\t\t\tset, nonEggSource, setSources, outOfBattleSpecies, ` because it has a move only available`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tif (eventProblems) problems.push(...eventProblems);\r\n\t\t\t\t\t\tif (species.id === 'mew' && pokemonGoProblems && pokemonGoProblems.length) {\r\n\t\t\t\t\t\t\tproblems.push(`Additionally, it failed to validate as a Pokemon from Pokemon GO because:`);\r\n\t\t\t\t\t\t\tfor (const pokemonGoProblem of pokemonGoProblems) {\r\n\t\t\t\t\t\t\t\tproblems.push(pokemonGoProblem);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (ruleTable.has('obtainablemisc') && (eventOnlyData = this.getEventOnlyData(outOfBattleSpecies))) {\r\n\t\t\tconst {species: eventSpecies, eventData} = eventOnlyData;\r\n\t\t\tlet legal = false;\r\n\t\t\tfor (const event of eventData) {\r\n\t\t\t\tif (this.validateEvent(set, setSources, event, eventSpecies)) continue;\r\n\t\t\t\tlegal = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif (!legal && species.gen <= 2 && dex.gen >= 7 && !this.validateSource(set, '7V', setSources, species)) {\r\n\t\t\t\tlegal = true;\r\n\t\t\t}\r\n\t\t\tif (!legal) {\r\n\t\t\t\tif (!pokemonGoProblems || (pokemonGoProblems && pokemonGoProblems.length)) {\r\n\t\t\t\t\tif (eventData.length === 1) {\r\n\t\t\t\t\t\tproblems.push(`${species.name} is only obtainable from an event - it needs to match its event:`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tproblems.push(`${species.name} is only obtainable from events - it needs to match one of its events:`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (const [i, event] of eventData.entries()) {\r\n\t\t\t\t\t\tif (event.generation <= dex.gen && event.generation >= this.minSourceGen) {\r\n\t\t\t\t\t\t\tconst eventInfo = event;\r\n\t\t\t\t\t\t\tconst eventNum = i + 1;\r\n\t\t\t\t\t\t\tconst eventName = eventData.length > 1 ? ` #${eventNum}` : ``;\r\n\t\t\t\t\t\t\tconst eventProblems = this.validateEvent(\r\n\t\t\t\t\t\t\t\tset, setSources, eventInfo, eventSpecies, ` to be`, `from its event${eventName}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tif (eventProblems) problems.push(...eventProblems);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (pokemonGoProblems && pokemonGoProblems.length) {\r\n\t\t\t\t\t\tproblems.push(`Additionally, it failed to validate as a Pokemon from Pokemon GO because:`);\r\n\t\t\t\t\t\tfor (const pokemonGoProblem of pokemonGoProblems) {\r\n\t\t\t\t\t\t\tproblems.push(pokemonGoProblem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetSources.isFromPokemonGo = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Hardcoded forced validation for Pokemon GO\r\n\t\tconst pokemonGoOnlySpecies = ['meltan', 'melmetal', 'gimmighoulroaming'];\r\n\t\tif (ruleTable.has('obtainablemisc') && (pokemonGoOnlySpecies.includes(species.id))) {\r\n\t\t\tsetSources.isFromPokemonGo = true;\r\n\t\t\tif (pokemonGoProblems && pokemonGoProblems.length) {\r\n\t\t\t\tproblems.push(`${name} is only obtainable from Pokemon GO, and failed to validate because:`);\r\n\t\t\t\tfor (const pokemonGoProblem of pokemonGoProblems) {\r\n\t\t\t\t\tproblems.push(pokemonGoProblem);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (ruleTable.isBanned('nonexistent')) {\r\n\t\t\tproblems.push(...this.validateStats(set, species, setSources, pokemonGoProblems));\r\n\t\t}\r\n\r\n\t\t// Attempt move validation again after verifying Pokemon GO origin\r\n\t\tif (ruleTable.has('obtainablemoves') && setSources.isFromPokemonGo) {\r\n\t\t\tsetSources.restrictiveMoves = [];\r\n\t\t\tsetSources.sources = ['8V'];\r\n\t\t\tsetSources.sourcesBefore = 0;\r\n\t\t\tif (moveProblems && !moveProblems.length) {\r\n\t\t\t\tproblems.push(...this.validateMoves(outOfBattleSpecies, set.moves, setSources, set, name,\r\n\t\t\t\t\tmoveLegalityWhitelist));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (ruleTable.has('obtainablemoves')) {\r\n\t\t\tif (species.id === 'keldeo' && set.moves.includes('secretsword') && this.minSourceGen > 5 && dex.gen <= 7) {\r\n\t\t\t\tproblems.push(`${name} has Secret Sword, which is only compatible with Keldeo-Ordinary obtained from Gen 5.`);\r\n\t\t\t}\r\n\t\t\tconst requiresGen3Source = setSources.maxSourceGen() <= 3;\r\n\t\t\tif (requiresGen3Source && dex.abilities.get(set.ability).gen === 4 && !species.prevo && dex.gen <= 5) {\r\n\t\t\t\t// Ability Capsule allows this in Gen 6+\r\n\t\t\t\tproblems.push(`${name} has a Gen 4 ability and isn't evolved - it can't use moves from Gen 3.`);\r\n\t\t\t}\r\n\t\t\tconst canUseAbilityPatch = dex.gen >= 8 && format.mod !== 'gen8dlc1';\r\n\t\t\tif (setSources.isHidden && !canUseAbilityPatch && setSources.maxSourceGen() < 5) {\r\n\t\t\t\tproblems.push(`${name} has a Hidden Ability - it can't use moves from before Gen 5.`);\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\tspecies.maleOnlyHidden && setSources.isHidden && setSources.sourcesBefore < 5 &&\r\n\t\t\t\tsetSources.sources.every(source => source.charAt(1) === 'E')\r\n\t\t\t) {\r\n\t\t\t\tproblems.push(`${name} has an unbreedable Hidden Ability - it can't use egg moves.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (teamHas) {\r\n\t\t\tfor (const i in setHas) {\r\n\t\t\t\tif (i in teamHas) {\r\n\t\t\t\t\tteamHas[i]++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tteamHas[i] = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (const [rule, source, limit, bans] of ruleTable.complexBans) {\r\n\t\t\tlet count = 0;\r\n\t\t\tfor (const ban of bans) {\r\n\t\t\t\tif (setHas[ban]) count++;\r\n\t\t\t}\r\n\t\t\tif (limit && count > limit) {\r\n\t\t\t\tconst clause = source ? ` by ${source}` : ``;\r\n\t\t\t\tproblems.push(`${name} is limited to ${limit} of ${rule}${clause}.`);\r\n\t\t\t} else if (!limit && count >= bans.length) {\r\n\t\t\t\tconst clause = source ? ` by ${source}` : ``;\r\n\t\t\t\tif (source === 'Obtainable Moves') {\r\n\t\t\t\t\tproblems.push(`${name} has the combination of ${rule}, which is impossible to obtain legitimately.`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tproblems.push(`${name} has the combination of ${rule}, which is banned${clause}.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (const [rule] of ruleTable) {\r\n\t\t\tif ('!+-'.includes(rule.charAt(0))) continue;\r\n\t\t\tconst subformat = dex.formats.get(rule);\r\n\t\t\tif (subformat.onValidateSet && ruleTable.has(subformat.id)) {\r\n\t\t\t\tproblems = problems.concat(subformat.onValidateSet.call(this, set, format, setHas, teamHas) || []);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (format.onValidateSet) {\r\n\t\t\tproblems = problems.concat(format.onValidateSet.call(this, set, format, setHas, teamHas) || []);\r\n\t\t}\r\n\r\n\t\tconst nameSpecies = dex.species.get(set.name);\r\n\t\tif (nameSpecies.exists && nameSpecies.name.toLowerCase() === set.name.toLowerCase()) {\r\n\t\t\t// nickname is the name of a species\r\n\t\t\tif (nameSpecies.baseSpecies === species.baseSpecies) {\r\n\t\t\t\tset.name = species.baseSpecies;\r\n\t\t\t} else if (nameSpecies.name !== species.name &&\r\n\t\t\t\tnameSpecies.name !== species.baseSpecies && ruleTable.has('nicknameclause')) {\r\n\t\t\t\t// nickname species doesn't match actual species\r\n\t\t\t\t// Nickname Clause\r\n\t\t\t\tproblems.push(`${name} must not be nicknamed a different Pok\u00E9mon species than what it actually is.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!problems.length) {\r\n\t\t\tif (set.gender === '' && !species.gender) {\r\n\t\t\t\tset.gender = ['M', 'F'][Math.floor(Math.random() * 2)];\r\n\t\t\t}\r\n\t\t\tif (adjustLevel) set.level = adjustLevel;\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn problems;\r\n\t}\r\n\r\n\tvalidateStats(set: PokemonSet, species: Species, setSources: PokemonSources, pokemonGoProblems: string[] | null) {\r\n\t\tconst ruleTable = this.ruleTable;\r\n\t\tconst dex = this.dex;\r\n\r\n\t\tconst allowAVs = ruleTable.has('allowavs');\r\n\t\tconst evLimit = ruleTable.evLimit;\r\n\t\tconst canBottleCap = dex.gen >= 7 && (set.level >= (dex.gen < 9 ? 100 : 50) || !ruleTable.has('obtainablemisc'));\r\n\r\n\t\tif (!set.evs) set.evs = TeamValidator.fillStats(null, evLimit === null ? 252 : 0);\r\n\t\tif (!set.ivs) set.ivs = TeamValidator.fillStats(null, 31);\r\n\r\n\t\tconst problems = [];\r\n\t\tconst name = set.name || set.species;\r\n\r\n\t\tconst maxedIVs = Object.values(set.ivs).every(stat => stat === 31);\r\n\t\tfor (const moveName of set.moves) {\r\n\t\t\tconst move = dex.moves.get(moveName);\r\n\t\t\tif (move.id === 'hiddenpower' && move.type !== 'Normal') {\r\n\t\t\t\tif (!set.hpType) {\r\n\t\t\t\t\tset.hpType = move.type;\r\n\t\t\t\t} else if (set.hpType !== move.type && ruleTable.has('obtainablemisc')) {\r\n\t\t\t\t\tproblems.push(`${name}'s Hidden Power type ${set.hpType} is incompatible with Hidden Power ${move.type}`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (set.hpType && maxedIVs && ruleTable.has('obtainablemisc')) {\r\n\t\t\tif (dex.gen <= 2) {\r\n\t\t\t\tconst HPdvs = dex.types.get(set.hpType).HPdvs;\r\n\t\t\t\tset.ivs = {hp: 30, atk: 30, def: 30, spa: 30, spd: 30, spe: 30};\r\n\t\t\t\tlet statName: StatID;\r\n\t\t\t\tfor (statName in HPdvs) {\r\n\t\t\t\t\tset.ivs[statName] = HPdvs[statName]! * 2;\r\n\t\t\t\t}\r\n\t\t\t\tset.ivs.hp = -1;\r\n\t\t\t} else if (!canBottleCap) {\r\n\t\t\t\tset.ivs = TeamValidator.fillStats(dex.types.get(set.hpType).HPivs, 31);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!set.hpType && set.moves.some(m => dex.moves.get(m).id === 'hiddenpower')) {\r\n\t\t\tset.hpType = dex.getHiddenPower(set.ivs).type;\r\n\t\t}\r\n\r\n\t\tconst cantBreedNorEvolve = (species.eggGroups[0] === 'Undiscovered' && !species.prevo && !species.nfe);\r\n\t\tconst isLegendary = (cantBreedNorEvolve && !species.tags.includes('Paradox') && ![\r\n\t\t\t'Pikachu', 'Unown', 'Dracozolt', 'Arctozolt', 'Dracovish', 'Arctovish', 'Gouging Fire', 'Raging Bolt', 'Iron Boulder', 'Iron Crown', 'Terapagos',\r\n\t\t].includes(species.baseSpecies)) || [\r\n\t\t\t'Manaphy', 'Cosmog', 'Cosmoem', 'Solgaleo', 'Lunala',\r\n\t\t].includes(species.baseSpecies);\r\n\t\tconst diancieException = species.name === 'Diancie' && !set.shiny;\r\n\t\tconst has3PerfectIVs = setSources.minSourceGen() >= 6 && isLegendary && !diancieException;\r\n\r\n\t\tif (set.hpType === 'Fighting' && ruleTable.has('obtainablemisc')) {\r\n\t\t\tif (has3PerfectIVs) {\r\n\t\t\t\t// Legendary Pokemon must have at least 3 perfect IVs in gen 6+\r\n\t\t\t\tproblems.push(`${name} must not have Hidden Power Fighting because it starts with 3 perfect IVs because it's a Gen 6+ legendary.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (has3PerfectIVs && ruleTable.has('obtainablemisc')) {\r\n\t\t\tlet perfectIVs = 0;\r\n\t\t\tfor (const stat in set.ivs) {\r\n\t\t\t\tif (set.ivs[stat as 'hp'] >= 31) perfectIVs++;\r\n\t\t\t}\r\n\t\t\tif (perfectIVs < 3) {\r\n\t\t\t\tif (!pokemonGoProblems || (pokemonGoProblems && pokemonGoProblems.length)) {\r\n\t\t\t\t\tconst reason = (this.minSourceGen === 6 ? ` and this format requires Gen ${dex.gen} Pok\u00E9mon` : ` in Gen 6 or later`);\r\n\t\t\t\t\tproblems.push(`${name} must have at least three perfect IVs because it's a legendary${reason}.`);\r\n\t\t\t\t\tif (pokemonGoProblems && pokemonGoProblems.length) {\r\n\t\t\t\t\t\tproblems.push(`Additionally, it failed to validate as a Pokemon from Pokemon GO because:`);\r\n\t\t\t\t\t\tfor (const pokemonGoProblem of pokemonGoProblems) {\r\n\t\t\t\t\t\t\tproblems.push(pokemonGoProblem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetSources.isFromPokemonGo = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (set.hpType && !canBottleCap) {\r\n\t\t\tconst ivHpType = dex.getHiddenPower(set.ivs).type;\r\n\t\t\tif (set.hpType !== ivHpType) {\r\n\t\t\t\tproblems.push(`${name} has Hidden Power ${set.hpType}, but its IVs are for Hidden Power ${ivHpType}.`);\r\n\t\t\t}\r\n\t\t} else if (set.hpType) {\r\n\t\t\tif (!this.possibleBottleCapHpType(set.hpType, set.ivs)) {\r\n\t\t\t\tproblems.push(`${name} has Hidden Power ${set.hpType}, but its IVs don't allow this even with (Bottle Cap) Hyper Training.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (setSources.isFromPokemonGo) {\r\n\t\t\t// Pokemon from Pokemon GO must have odd IVs in non-Spe stats\r\n\t\t\t// Since the set can be fixed while making minimal changes, it does not force the IVs to be manually fixed\r\n\t\t\tfor (const stat in set.ivs) {\r\n\t\t\t\tif (set.ivs[stat as 'hp'] % 2 === 0 && stat !== 'spe') {\r\n\t\t\t\t\tset.ivs[stat as 'hp']++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (set.ivs.atk !== set.ivs.spa && !(canBottleCap && (set.ivs.atk === 31 || set.ivs.spa === 31))) {\r\n\t\t\t\tproblems.push(`${name}'s Atk and Spa IVs must match because it is from Pokemon GO.`);\r\n\t\t\t}\r\n\t\t\tif (set.ivs.def !== set.ivs.spd && !(canBottleCap && (set.ivs.def === 31 || set.ivs.spd === 31))) {\r\n\t\t\t\tproblems.push(`${name}'s Def and Spd IVs must match because it is from Pokemon GO.`);\r\n\t\t\t}\r\n\t\t\tif (set.hpType && set.hpType !== 'Dark' && set.hpType !== 'Ice') {\r\n\t\t\t\tproblems.push(`${name} must have Hidden Power Dark or Ice because it is from Pokemon GO.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (dex.gen <= 2) {\r\n\t\t\t// validate DVs\r\n\t\t\tconst ivs = set.ivs;\r\n\t\t\tconst atkDV = Math.floor(ivs.atk / 2);\r\n\t\t\tconst defDV = Math.floor(ivs.def / 2);\r\n\t\t\tconst speDV = Math.floor(ivs.spe / 2);\r\n\t\t\tconst spcDV = Math.floor(ivs.spa / 2);\r\n\t\t\tconst expectedHpDV = (atkDV % 2) * 8 + (defDV % 2) * 4 + (speDV % 2) * 2 + (spcDV % 2);\r\n\t\t\tif (ivs.hp === -1) ivs.hp = expectedHpDV * 2;\r\n\t\t\tconst hpDV = Math.floor(ivs.hp / 2);\r\n\t\t\tif (expectedHpDV !== hpDV) {\r\n\t\t\t\tproblems.push(`${name} has an HP DV of ${hpDV}, but its Atk, Def, Spe, and Spc DVs give it an HP DV of ${expectedHpDV}.`);\r\n\t\t\t}\r\n\t\t\tif (ivs.spa !== ivs.spd) {\r\n\t\t\t\tif (dex.gen === 2) {\r\n\t\t\t\t\tproblems.push(`${name} has different SpA and SpD DVs, which is not possible in Gen 2.`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tivs.spd = ivs.spa;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (dex.gen > 1 && !species.gender) {\r\n\t\t\t\t// Gen 2 gender is calculated from the Atk DV.\r\n\t\t\t\t// High Atk DV <-> M. The meaning of \"high\" depends on the gender ratio.\r\n\t\t\t\tconst genderThreshold = species.genderRatio.F * 16;\r\n\r\n\t\t\t\tconst expectedGender = (atkDV >= genderThreshold ? 'M' : 'F');\r\n\t\t\t\tif (set.gender && set.gender !== expectedGender) {\r\n\t\t\t\t\tproblems.push(`${name} is ${set.gender}, but it has an Atk DV of ${atkDV}, which makes its gender ${expectedGender}.`);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tset.gender = expectedGender;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (\r\n\t\t\t\tset.species === 'Marowak' && toID(set.item) === 'thickclub' &&\r\n\t\t\t\tset.moves.map(toID).includes('swordsdance' as ID) && set.level === 100\r\n\t\t\t) {\r\n\t\t\t\t// Marowak hack\r\n\t\t\t\tset.ivs.atk = Math.floor(set.ivs.atk / 2) * 2;\r\n\t\t\t\twhile (set.evs.atk > 0 && 2 * 80 + set.ivs.atk + Math.floor(set.evs.atk / 4) + 5 > 255) {\r\n\t\t\t\t\tset.evs.atk -= 4;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (dex.gen > 1) {\r\n\t\t\t\tconst expectedShiny = !!(defDV === 10 && speDV === 10 && spcDV === 10 && atkDV % 4 >= 2);\r\n\t\t\t\tif (expectedShiny && !set.shiny) {\r\n\t\t\t\t\tproblems.push(`${name} is not shiny, which does not match its DVs.`);\r\n\t\t\t\t} else if (!expectedShiny && set.shiny) {\r\n\t\t\t\t\tproblems.push(`${name} is shiny, which does not match its DVs (its DVs must all be 10, except Atk which must be 2, 3, 6, 7, 10, 11, 14, or 15).`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tset.nature = 'Serious';\r\n\t\t}\r\n\r\n\t\tfor (const stat in set.evs) {\r\n\t\t\tif (set.evs[stat as 'hp'] < 0) {\r\n\t\t\t\tproblems.push(`${name} has less than 0 ${allowAVs ? 'Awakening Values' : 'EVs'} in ${Dex.stats.names[stat as 'hp']}.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (dex.currentMod === 'gen7letsgo') { // AVs\r\n\t\t\tfor (const stat in set.evs) {\r\n\t\t\t\tif (set.evs[stat as 'hp'] > 0 && !allowAVs) {\r\n\t\t\t\t\tproblems.push(`${name} has Awakening Values but this format doesn't allow them.`);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if (set.evs[stat as 'hp'] > 200) {\r\n\t\t\t\t\tproblems.push(`${name} has more than 200 Awakening Values in ${Dex.stats.names[stat as 'hp']}.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else { // EVs\r\n\t\t\tfor (const stat in set.evs) {\r\n\t\t\t\tif (set.evs[stat as StatID] > 255) {\r\n\t\t\t\t\tproblems.push(`${name} has more than 255 EVs in ${Dex.stats.names[stat as 'hp']}.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (dex.gen <= 2) {\r\n\t\t\t\tif (set.evs.spa !== set.evs.spd) {\r\n\t\t\t\t\tif (dex.gen === 2) {\r\n\t\t\t\t\t\tproblems.push(`${name} has different SpA and SpD EVs, which is not possible in Gen 2.`);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tset.evs.spd = set.evs.spa;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet totalEV = 0;\r\n\t\tfor (const stat in set.evs) totalEV += set.evs[stat as 'hp'];\r\n\t\tif (!this.format.debug) {\r\n\t\t\tif (set.level > 1 && evLimit !== 0 && totalEV === 0) {\r\n\t\t\t\tproblems.push(`${name} has exactly 0 EVs - did you forget to EV it? (If this was intentional, add exactly 1 to one of your EVs, which won't change its stats but will tell us that it wasn't a mistake).`);\r\n\t\t\t} else if (![508, 510].includes(evLimit!) && [508, 510].includes(totalEV)) {\r\n\t\t\t\tproblems.push(`${name} has exactly ${totalEV} EVs, but this format does not restrict you to 510 EVs (If this was intentional, add exactly 1 to one of your EVs, which won't change its stats but will tell us that it wasn't a mistake).`);\r\n\t\t\t}\r\n\t\t\t// Check for level import errors from user in VGC -> DOU, etc.\r\n\t\t\t// Note that in VGC etc (Adjust Level Down = 50), `set.level` will be 100 here for validation purposes\r\n\t\t\tif (set.level === 50 && ruleTable.maxLevel !== 50 && !ruleTable.maxTotalLevel && evLimit !== 0 && totalEV % 4 === 0) {\r\n\t\t\t\tproblems.push(`${name} is level 50, but this format allows level ${ruleTable.maxLevel} Pok\u00E9mon. (If this was intentional, add exactly 1 to one of your EVs, which won't change its stats but will tell us that it wasn't a mistake).`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (evLimit !== null && totalEV > evLimit) {\r\n\t\t\tif (!evLimit) {\r\n\t\t\t\tproblems.push(`${name} has EVs, which is not allowed by this format.`);\r\n\t\t\t} else {\r\n\t\t\t\tproblems.push(`${name} has ${totalEV} total EVs, which is more than this format's limit of ${evLimit}.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn problems;\r\n\t}\r\n\r\n\t/**\r\n\t * Not exhaustive, just checks Atk and Spe, which are the only competitively\r\n\t * relevant IVs outside of extremely obscure situations.\r\n\t */\r\n\tpossibleBottleCapHpType(type: string, ivs: StatsTable) {\r\n\t\tif (!type) return true;\r\n\t\tif (['Dark', 'Dragon', 'Grass', 'Ghost', 'Poison'].includes(type)) {\r\n\t\t\t// Spe must be odd\r\n\t\t\tif (ivs.spe % 2 === 0) return false;\r\n\t\t}\r\n\t\tif (['Psychic', 'Fire', 'Rock', 'Fighting'].includes(type)) {\r\n\t\t\t// Spe must be even\r\n\t\t\tif (ivs.spe !== 31 && ivs.spe % 2 === 1) return false;\r\n\t\t}\r\n\t\tif (type === 'Dark') {\r\n\t\t\t// Atk must be odd\r\n\t\t\tif (ivs.atk % 2 === 0) return false;\r\n\t\t}\r\n\t\tif (['Ice', 'Water'].includes(type)) {\r\n\t\t\t// Spe or Atk must be odd\r\n\t\t\tif (ivs.spe % 2 === 0 && ivs.atk % 2 === 0) return false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tvalidateSource(\r\n\t\tset: PokemonSet, source: PokemonSource, setSources: PokemonSources, species: Species, because: string\r\n\t): string[] | undefined;\r\n\tvalidateSource(\r\n\t\tset: PokemonSet, source: PokemonSource, setSources: PokemonSources, species: Species\r\n\t): true | undefined;\r\n\t/**\r\n\t * Returns array of error messages if invalid, undefined if valid\r\n\t *\r\n\t * If `because` is not passed, instead returns true if invalid.\r\n\t */\r\n\tvalidateSource(\r\n\t\tset: PokemonSet, source: PokemonSource, setSources: PokemonSources, species: Species, because?: string\r\n\t) {\r\n\t\tlet eventData: EventInfo | undefined;\r\n\t\tlet eventSpecies = species;\r\n\t\tif (source.charAt(1) === 'S') {\r\n\t\t\tconst splitSource = source.substr(source.charAt(2) === 'T' ? 3 : 2).split(' ');\r\n\t\t\tconst dex = (this.dex.gen === 1 ? this.dex.mod('gen2') : this.dex);\r\n\t\t\teventSpecies = dex.species.get(splitSource[1]);\r\n\t\t\tconst eventLsetData = this.dex.species.getLearnsetData(eventSpecies.id);\r\n\t\t\teventData = eventLsetData.eventData?.[parseInt(splitSource[0])];\r\n\t\t\tif (!eventData) {\r\n\t\t\t\tthrow new Error(`${eventSpecies.name} from ${species.name} doesn't have data for event ${source}`);\r\n\t\t\t}\r\n\t\t} else if (source === '7V') {\r\n\t\t\tconst isMew = species.id === 'mew';\r\n\t\t\tconst isCelebi = species.id === 'celebi';\r\n\t\t\tconst g7speciesName = (species.gen > 2 && species.prevo) ? species.prevo : species.id;\r\n\t\t\tconst isHidden = !!this.dex.mod('gen7').species.get(g7speciesName).abilities['H'];\r\n\t\t\teventData = {\r\n\t\t\t\tgeneration: 2,\r\n\t\t\t\tlevel: isMew ? 5 : isCelebi ? 30 : 3, // Level 1/2 Pok\u00E9mon can't be obtained by transfer from RBY/GSC\r\n\t\t\t\tperfectIVs: isMew || isCelebi ? 5 : 3,\r\n\t\t\t\tisHidden,\r\n\t\t\t\tshiny: isMew ? undefined : 1,\r\n\t\t\t\tpokeball: 'pokeball',\r\n\t\t\t\tfrom: 'Gen 1-2 Virtual Console transfer',\r\n\t\t\t};\r\n\t\t} else if (source === '8V') {\r\n\t\t\tconst isMew = species.id === 'mew';\r\n\t\t\teventData = {\r\n\t\t\t\tgeneration: 8,\r\n\t\t\t\tperfectIVs: isMew ? 3 : undefined,\r\n\t\t\t\tshiny: isMew ? undefined : 1,\r\n\t\t\t\tfrom: 'Gen 7 Let\\'s Go! HOME transfer',\r\n\t\t\t};\r\n\t\t} else if (source.charAt(1) === 'D') {\r\n\t\t\teventData = {\r\n\t\t\t\tgeneration: 5,\r\n\t\t\t\tlevel: 10,\r\n\t\t\t\tfrom: 'Gen 5 Dream World',\r\n\t\t\t\tisHidden: !!this.dex.mod('gen5').species.get(species.id).abilities['H'],\r\n\t\t\t};\r\n\t\t} else if (source.charAt(1) === 'E') {\r\n\t\t\tif (this.findEggMoveFathers(source, species, setSources)) {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t\tif (because) throw new Error(`Wrong place to get an egg incompatibility message`);\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\tthrow new Error(`Unidentified source ${source} passed to validateSource`);\r\n\t\t}\r\n\r\n\t\t// complicated fancy return signature\r\n\t\treturn this.validateEvent(set, setSources, eventData, eventSpecies, because as any) as any;\r\n\t}\r\n\r\n\tfindEggMoveFathers(source: PokemonSource, species: Species, setSources: PokemonSources,\r\n\t\tgetAll?: false, pokemonBlacklist?: ID[], noRecurse?: true): boolean;\r\n\tfindEggMoveFathers(source: PokemonSource, species: Species, setSources: PokemonSources, getAll?: true): ID[] | null;\r\n\tfindEggMoveFathers(source: PokemonSource, species: Species, setSources: PokemonSources,\r\n\t\tgetAll?: boolean, pokemonBlacklist?: ID[], noRecurse?: boolean) {\r\n\t\tif (!pokemonBlacklist) pokemonBlacklist = [];\r\n\t\tif (!pokemonBlacklist.includes(species.id)) pokemonBlacklist.push(species.id);\r\n\t\t// tradebacks have an eggGen of 2 even though the source is 1ET\r\n\t\tconst eggGen = Math.max(parseInt(source.charAt(0)), 2);\r\n\t\tconst fathers: ID[] = [];\r\n\t\t// Gen 6+ don't have egg move incompatibilities\r\n\t\t// (except for certain cases with baby Pokemon not handled here)\r\n\t\tif (!getAll && eggGen >= 6 && !setSources.levelUpEggMoves) return true;\r\n\r\n\t\tlet eggMoves = setSources.limitedEggMoves;\r\n\t\tif (eggGen === 3) eggMoves = eggMoves?.filter(eggMove => !setSources.pomegEggMoves?.includes(eggMove));\r\n\t\t// must have 2 or more egg moves to have egg move incompatibilities\r\n\t\tif (!eggMoves) {\r\n\t\t\t// happens often in gen 1-6 LC if your only egg moves are level-up moves,\r\n\t\t\t// which aren't limited and so aren't in `limitedEggMoves`\r\n\t\t\treturn getAll ? ['*'] : true;\r\n\t\t}\r\n\t\tif (!getAll && eggMoves.length <= 1 && !setSources.levelUpEggMoves) return true;\r\n\t\tif (setSources.levelUpEggMoves && eggGen >= 6) eggMoves = setSources.levelUpEggMoves;\r\n\r\n\t\t// gen 1 eggs come from gen 2 breeding\r\n\t\tconst dex = this.dex.gen === 1 ? this.dex.mod('gen2') : this.dex;\r\n\t\t// In Gen 5 and earlier, egg moves can only be inherited from the father\r\n\t\t// we'll test each possible father separately\r\n\t\tlet eggGroups = species.eggGroups;\r\n\t\tif (species.id === 'nidoqueen' || species.id === 'nidorina') {\r\n\t\t\teggGroups = dex.species.get('nidoranf').eggGroups;\r\n\t\t} else if (species.id === 'shedinja') {\r\n\t\t\t// Shedinja and Nincada are different Egg groups; Shedinja itself is genderless\r\n\t\t\teggGroups = dex.species.get('nincada').eggGroups;\r\n\t\t} else if (dex !== this.dex) {\r\n\t\t\t// Gen 1 tradeback; grab the egg groups from Gen 2\r\n\t\t\teggGroups = dex.species.get(species.id).eggGroups;\r\n\t\t}\r\n\t\tif (eggGroups[0] === 'Undiscovered') eggGroups = dex.species.get(species.evos[0]).eggGroups;\r\n\t\tif (eggGroups[0] === 'Undiscovered' || !eggGroups.length) {\r\n\t\t\tthrow new Error(`${species.name} has no egg groups for source ${source}`);\r\n\t\t}\r\n\t\t// no chainbreeding necessary if the father can be Smeargle\r\n\t\tif (!getAll && eggGroups.includes('Field')) return true;\r\n\r\n\t\t// try to find a father to inherit the egg move combination from\r\n\t\tfor (const father of dex.species.all()) {\r\n\t\t\t// can't inherit from CAP pokemon\r\n\t\t\tif (father.isNonstandard) continue;\r\n\t\t\t// can't breed mons from future gens\r\n\t\t\tif (father.gen > eggGen) continue;\r\n\t\t\t// father must be male\r\n\t\t\tif (father.gender === 'N' || father.gender === 'F') continue;\r\n\t\t\t// can't inherit from dex entries with no learnsets\r\n\t\t\tif (!dex.species.getLearnsetData(father.id).learnset) continue;\r\n\t\t\t// something is clearly wrong if its only possible father is itself\r\n\t\t\t// (exceptions: ExtremeSpeed Dragonite, Self-destruct Snorlax)\r\n\t\t\tif (pokemonBlacklist.includes(father.id) && !['dragonite', 'snorlax'].includes(father.id)) continue;\r\n\t\t\t// don't check NFE Pok\u00E9mon - their evolutions will know all their moves and more\r\n\t\t\t// exception: Combee/Salandit, because their evos can't be fathers\r\n\t\t\tif (father.evos.length) {\r\n\t\t\t\tconst evolvedFather = dex.species.get(father.evos[0]);\r\n\t\t\t\tif (evolvedFather.gen <= eggGen && evolvedFather.gender !== 'F') continue;\r\n\t\t\t}\r\n\r\n\t\t\t// must be able to breed with father\r\n\t\t\tif (!father.eggGroups.some(eggGroup => eggGroups.includes(eggGroup))) continue;\r\n\r\n\t\t\t// father must be able to learn the move\r\n\t\t\tif (!this.fatherCanLearn(species, father, eggMoves, eggGen, pokemonBlacklist, noRecurse)) continue;\r\n\r\n\t\t\t// father found!\r\n\t\t\tif (!getAll) return true;\r\n\t\t\tfathers.push(father.id);\r\n\t\t}\r\n\t\tif (!getAll) return false;\r\n\t\treturn (!fathers.length && eggGen < 6) ? null : fathers;\r\n\t}\r\n\r\n\t/**\r\n\t * We could, if we wanted, do a complete move validation of the father's\r\n\t * moveset to see if it's valid. This would recurse and be NP-Hard so\r\n\t * instead we won't. We'll instead use a simplified algorithm: The father\r\n\t * is allowed to have multiple egg moves and a maximum of one move from\r\n\t * any other restrictive source; recursion is done only if there are less\r\n\t * egg moves to validate or if the father has an egg group it doesn't\r\n\t * share with the egg Pokemon. Recursion is also limited to two iterations\r\n\t * of calling findEggMoveFathers.\r\n\t */\r\n\tfatherCanLearn(baseSpecies: Species, species: Species, moves: ID[], eggGen: number, pokemonBlacklist: ID[],\r\n\t\tnoRecurse: boolean | undefined) {\r\n\t\tif (!this.dex.species.getLearnsetData(species.id).learnset) return false;\r\n\r\n\t\tif (species.id === 'smeargle') return true;\r\n\t\tconst canBreedWithSmeargle = species.eggGroups.includes('Field');\r\n\r\n\t\tconst allEggSources = new PokemonSources();\r\n\t\tallEggSources.sourcesBefore = eggGen;\r\n\t\tfor (const move of moves) {\r\n\t\t\tconst eggSources = new PokemonSources();\r\n\t\t\tfor (const {learnset, species: curSpecies} of this.dex.species.getFullLearnset(species.id)) {\r\n\t\t\t\tconst eggPokemon = curSpecies.prevo ? curSpecies.id : '';\r\n\t\t\t\tif (learnset[move]) {\r\n\t\t\t\t\tfor (const moveSource of learnset[move]) {\r\n\t\t\t\t\t\tif (eggGen > 8 && parseInt(moveSource.charAt(0)) <= 8) continue;\r\n\t\t\t\t\t\tif (parseInt(moveSource.charAt(0)) > eggGen) continue;\r\n\t\t\t\t\t\tconst canLearnFromSmeargle = moveSource.charAt(1) === 'E' && canBreedWithSmeargle;\r\n\t\t\t\t\t\tif (!'ESDV'.includes(moveSource.charAt(1)) || canLearnFromSmeargle) {\r\n\t\t\t\t\t\t\teggSources.addGen(parseInt(moveSource.charAt(0)));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (moveSource.charAt(1) === 'E') {\r\n\t\t\t\t\t\t\t\teggSources.add(moveSource + eggPokemon, move);\r\n\t\t\t\t\t\t\t\tif (eggGen === 2 && this.dex.moves.getByID(move).gen === 1) eggSources.add('1ET' + eggPokemon, move);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\teggSources.add(moveSource + eggPokemon);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (eggSources.sourcesBefore === eggGen) break;\r\n\t\t\t}\r\n\r\n\t\t\tif (eggSources.sourcesBefore === eggGen) continue;\r\n\t\t\tif (!eggSources.sourcesBefore && !eggSources.sources.length) return false;\r\n\t\t\tconst onlyEggSources = eggSources.sources.filter(source => source.charAt(1) === 'E');\r\n\t\t\tif (eggGen >= 3 && onlyEggSources.length && eggSources.limitedEggMoves === null && eggSources.sourcesBefore) {\r\n\t\t\t\teggSources.possiblyLimitedEggMoves = [toID(eggSources.sourcesBefore + move)];\r\n\t\t\t}\r\n\t\t\tallEggSources.intersectWith(eggSources);\r\n\t\t\tif (!allEggSources.size()) return false;\r\n\t\t}\r\n\t\tpokemonBlacklist.push(species.id);\r\n\t\tif (allEggSources.limitedEggMoves && allEggSources.limitedEggMoves.length > 1) {\r\n\t\t\tif (noRecurse) return false;\r\n\t\t\tlet canChainbreed = false;\r\n\t\t\tfor (const fatherEggGroup of species.eggGroups) {\r\n\t\t\t\tif (!baseSpecies.eggGroups.includes(fatherEggGroup)) {\r\n\t\t\t\t\tcanChainbreed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!canChainbreed && allEggSources.limitedEggMoves.length === moves.length) return false;\r\n\t\t\tconst setSources = new PokemonSources();\r\n\t\t\tsetSources.limitedEggMoves = allEggSources.limitedEggMoves;\r\n\t\t\treturn this.findEggMoveFathers(allEggSources.sources[0], species, setSources, false, pokemonBlacklist, true);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tvalidateForme(set: PokemonSet) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst name = set.name || set.species;\r\n\r\n\t\tconst problems = [];\r\n\t\tconst item = dex.items.get(set.item);\r\n\t\tconst species = dex.species.get(set.species);\r\n\r\n\t\tif (species.name === 'Necrozma-Ultra') {\r\n\t\t\tconst whichMoves = (set.moves.includes('sunsteelstrike') ? 1 : 0) +\r\n\t\t\t\t(set.moves.includes('moongeistbeam') ? 2 : 0);\r\n\t\t\tif (item.name !== 'Ultranecrozium Z') {\r\n\t\t\t\t// Necrozma-Ultra transforms from one of two formes, and neither one is the base forme\r\n\t\t\t\tproblems.push(`Necrozma-Ultra must start the battle holding Ultranecrozium Z.`);\r\n\t\t\t} else if (whichMoves === 1) {\r\n\t\t\t\tset.species = 'Necrozma-Dusk-Mane';\r\n\t\t\t} else if (whichMoves === 2) {\r\n\t\t\t\tset.species = 'Necrozma-Dawn-Wings';\r\n\t\t\t} else {\r\n\t\t\t\tproblems.push(`Necrozma-Ultra must start the battle as Necrozma-Dusk-Mane or Necrozma-Dawn-Wings holding Ultranecrozium Z. Please specify which Necrozma it should start as.`);\r\n\t\t\t}\r\n\t\t} else if (species.name === 'Zygarde-Complete') {\r\n\t\t\tproblems.push(`Zygarde-Complete must start the battle as Zygarde or Zygarde-10% with Power Construct. Please specify which Zygarde it should start as.`);\r\n\t\t} else if (species.battleOnly) {\r\n\t\t\tif (species.requiredAbility && set.ability !== species.requiredAbility) {\r\n\t\t\t\t// Darmanitan-Zen\r\n\t\t\t\tproblems.push(`${species.name} transforms in-battle with ${species.requiredAbility}, please fix its ability.`);\r\n\t\t\t}\r\n\t\t\tif (species.requiredItems) {\r\n\t\t\t\tif (!species.requiredItems.includes(item.name)) {\r\n\t\t\t\t\t// Mega or Primal\r\n\t\t\t\t\tproblems.push(`${species.name} transforms in-battle with ${species.requiredItem}, please fix its item.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (species.requiredMove && !set.moves.map(toID).includes(toID(species.requiredMove))) {\r\n\t\t\t\t// Meloetta-Pirouette, Rayquaza-Mega\r\n\t\t\t\tproblems.push(`${species.name} transforms in-battle with ${species.requiredMove}, please fix its moves.`);\r\n\t\t\t}\r\n\t\t\tif (typeof species.battleOnly !== 'string') {\r\n\t\t\t\t// Ultra Necrozma and Complete Zygarde are already checked above\r\n\t\t\t\tthrow new Error(`${species.name} should have a string battleOnly`);\r\n\t\t\t}\r\n\t\t\t// Set to out-of-battle forme\r\n\t\t\tset.species = species.battleOnly;\r\n\t\t} else {\r\n\t\t\tif (species.requiredAbility) {\r\n\t\t\t\t// Impossible!\r\n\t\t\t\tthrow new Error(`Species ${species.name} has a required ability despite not being a battle-only forme; it should just be in its abilities table.`);\r\n\t\t\t}\r\n\t\t\tif (species.requiredItems && !species.requiredItems.includes(item.name)) {\r\n\t\t\t\tif (dex.gen >= 8 && (species.baseSpecies === 'Arceus' || species.baseSpecies === 'Silvally')) {\r\n\t\t\t\t\t// Arceus/Silvally formes in gen 8 only require the item with Multitype/RKS System\r\n\t\t\t\t\tif (set.ability === species.abilities[0]) {\r\n\t\t\t\t\t\tproblems.push(\r\n\t\t\t\t\t\t\t`${name} needs to hold ${species.requiredItems.join(' or ')}.`,\r\n\t\t\t\t\t\t\t`(It will revert to its Normal forme if you remove the item or give it a different item.)`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Memory/Drive/Griseous Orb/Plate/Z-Crystal - Forme mismatch\r\n\t\t\t\t\tconst baseSpecies = this.dex.species.get(species.changesFrom);\r\n\t\t\t\t\tproblems.push(\r\n\t\t\t\t\t\t`${name} needs to hold ${species.requiredItems.join(' or ')} to be in its ${species.forme} forme.`,\r\n\t\t\t\t\t\t`(It will revert to its ${baseSpecies.baseForme || 'base'} forme if you remove the item or give it a different item.)`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (species.requiredMove && !set.moves.map(toID).includes(toID(species.requiredMove))) {\r\n\t\t\t\tconst baseSpecies = this.dex.species.get(species.changesFrom);\r\n\t\t\t\tproblems.push(\r\n\t\t\t\t\t`${name} needs to know the move ${species.requiredMove} to be in its ${species.forme} forme.`,\r\n\t\t\t\t\t`(It will revert to its ${baseSpecies.baseForme} forme if it forgets the move.)`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Mismatches between the set forme (if not base) and the item signature forme will have been rejected already.\r\n\t\t\t// It only remains to assign the right forme to a set with the base species (Arceus/Genesect/Giratina/Silvally).\r\n\t\t\tif (item.forcedForme && species.name === dex.species.get(item.forcedForme).baseSpecies) {\r\n\t\t\t\tset.species = item.forcedForme;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (species.name === 'Pikachu-Cosplay') {\r\n\t\t\tconst cosplay: {[k: string]: string} = {\r\n\t\t\t\tmeteormash: 'Pikachu-Rock-Star', iciclecrash: 'Pikachu-Belle', drainingkiss: 'Pikachu-Pop-Star',\r\n\t\t\t\telectricterrain: 'Pikachu-PhD', flyingpress: 'Pikachu-Libre',\r\n\t\t\t};\r\n\t\t\tfor (const moveid of set.moves) {\r\n\t\t\t\tif (moveid in cosplay) {\r\n\t\t\t\t\tset.species = cosplay[moveid];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (species.name === 'Keldeo' && set.moves.map(toID).includes('secretsword' as ID) && dex.gen >= 8) {\r\n\t\t\tset.species = 'Keldeo-Resolute';\r\n\t\t}\r\n\r\n\t\tconst crowned: {[k: string]: string} = {\r\n\t\t\t'Zacian-Crowned': 'behemothblade', 'Zamazenta-Crowned': 'behemothbash',\r\n\t\t};\r\n\t\tif (species.name in crowned) {\r\n\t\t\tconst behemothMove = set.moves.map(toID).indexOf(crowned[species.name] as ID);\r\n\t\t\tif (behemothMove >= 0) {\r\n\t\t\t\tset.moves[behemothMove] = 'ironhead';\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (species.baseSpecies === \"Hoopa\" && dex.gen >= 9) {\r\n\t\t\tconst moves = set.moves.map(toID);\r\n\t\t\tconst hyperspaceHole = moves.indexOf('hyperspacehole' as ID);\r\n\t\t\tconst hyperspaceFury = moves.indexOf('hyperspacefury' as ID);\r\n\t\t\tif (species.name === \"Hoopa\" && hyperspaceFury >= 0) {\r\n\t\t\t\tproblems.push(`In Generation 9, Hoopa cannot run Hyperspace Fury because it gets replaced with Hyperspace Hole upon changing forme.`);\r\n\t\t\t} else if (species.name === \"Hoopa-Unbound\" && hyperspaceHole >= 0) {\r\n\t\t\t\tproblems.push(`In Generation 9, Hoopa-Unbound cannot run Hyperspace Hole because it gets replaced with Hyperspace Fury upon changing forme.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (species.baseSpecies === \"Greninja\" && toID(set.ability) === 'battlebond') {\r\n\t\t\tset.species = \"Greninja-Bond\";\r\n\t\t}\r\n\r\n\t\tif (species.baseSpecies === \"Unown\" && dex.gen === 2) {\r\n\t\t\tlet resultBinary = '';\r\n\t\t\tfor (const iv of ['atk', 'def', 'spe', 'spa'] as const) {\r\n\t\t\t\tresultBinary += set.ivs[iv].toString(2).padStart(5, '0').slice(1, 3);\r\n\t\t\t}\r\n\t\t\tconst resultDecimal = Math.floor(parseInt(resultBinary, 2) / 10);\r\n\t\t\tconst expectedLetter = String.fromCharCode(resultDecimal + 65);\r\n\t\t\tconst unownLetter = species.forme || \"A\";\r\n\t\t\tif (unownLetter !== expectedLetter) {\r\n\t\t\t\tproblems.push(`Unown has forme ${unownLetter}, but its DVs give it the forme ${expectedLetter}.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn problems;\r\n\t}\r\n\r\n\tcheckSpecies(set: PokemonSet, species: Species, tierSpecies: Species, setHas: {[k: string]: true}) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\t// https://www.smogon.com/forums/posts/8659168\r\n\t\tif (\r\n\t\t\t(tierSpecies.id === 'zamazentacrowned' && species.id === 'zamazenta') ||\r\n\t\t\t(tierSpecies.id === 'zaciancrowned' && species.id === 'zacian')\r\n\t\t) {\r\n\t\t\tspecies = tierSpecies;\r\n\t\t}\r\n\r\n\t\tsetHas['pokemon:' + species.id] = true;\r\n\t\tsetHas['basepokemon:' + toID(species.baseSpecies)] = true;\r\n\r\n\t\tlet isMega = false;\r\n\t\tif (tierSpecies !== species) {\r\n\t\t\tsetHas['pokemon:' + tierSpecies.id] = true;\r\n\t\t\tif (tierSpecies.isMega || tierSpecies.isPrimal) {\r\n\t\t\t\tsetHas['pokemontag:mega'] = true;\r\n\t\t\t\tisMega = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet isGmax = false;\r\n\t\tif (tierSpecies.canGigantamax && set.gigantamax) {\r\n\t\t\tsetHas['pokemon:' + tierSpecies.id + 'gmax'] = true;\r\n\t\t\tisGmax = true;\r\n\t\t}\r\n\t\tif (tierSpecies.baseSpecies === 'Greninja' && toID(set.ability) === 'battlebond') {\r\n\t\t\tsetHas['pokemon:greninjabond'] = true;\r\n\t\t}\r\n\r\n\t\tconst tier = tierSpecies.tier === '(PU)' ? 'ZU' : tierSpecies.tier === '(NU)' ? 'PU' : tierSpecies.tier;\r\n\t\tconst tierTag = 'pokemontag:' + toID(tier);\r\n\t\tsetHas[tierTag] = true;\r\n\r\n\t\tconst doublesTier = tierSpecies.doublesTier === '(DUU)' ? 'DNU' : tierSpecies.doublesTier;\r\n\t\tconst doublesTierTag = 'pokemontag:' + toID(doublesTier);\r\n\t\tsetHas[doublesTierTag] = true;\r\n\r\n\t\tconst ndTier = tierSpecies.natDexTier === '(PU)' ? 'ZU' :\r\n\t\t\ttierSpecies.natDexTier === '(NU)' ? 'PU' : tierSpecies.natDexTier;\r\n\t\tconst ndTierTag = 'pokemontag:nd' + toID(ndTier);\r\n\t\tsetHas[ndTierTag] = true;\r\n\r\n\t\t// Only pokemon that can gigantamax should have the Gmax flag\r\n\t\tif (!tierSpecies.canGigantamax && set.gigantamax) {\r\n\t\t\treturn `${tierSpecies.name} cannot Gigantamax but is flagged as being able to.`;\r\n\t\t}\r\n\r\n\t\tlet banReason = ruleTable.check('pokemon:' + species.id);\r\n\t\tif (banReason) {\r\n\t\t\treturn `${species.name} is ${banReason}.`;\r\n\t\t}\r\n\t\tif (banReason === '') return null;\r\n\r\n\t\tif (tierSpecies !== species) {\r\n\t\t\tbanReason = ruleTable.check('pokemon:' + tierSpecies.id);\r\n\t\t\tif (banReason) {\r\n\t\t\t\treturn `${tierSpecies.name} is ${banReason}.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\tif (isMega) {\r\n\t\t\tbanReason = ruleTable.check('pokemontag:mega', setHas);\r\n\t\t\tif (banReason) {\r\n\t\t\t\treturn `Mega evolutions are ${banReason}.`;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (isGmax) {\r\n\t\t\tbanReason = ruleTable.check('pokemon:' + tierSpecies.id + 'gmax');\r\n\t\t\tif (banReason) {\r\n\t\t\t\treturn `Gigantamaxing ${species.name} is ${banReason}.`;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tbanReason = ruleTable.check('basepokemon:' + toID(species.baseSpecies));\r\n\t\tif (banReason) {\r\n\t\t\treturn `${species.name} is ${banReason}.`;\r\n\t\t}\r\n\t\tif (banReason === '') {\r\n\t\t\t// don't allow nonstandard speciess when whitelisting standard base species\r\n\t\t\t// i.e. unbanning Pichu doesn't mean allowing Pichu-Spiky-Eared outside of Gen 4\r\n\t\t\tconst baseSpecies = dex.species.get(species.baseSpecies);\r\n\t\t\tif (baseSpecies.isNonstandard === species.isNonstandard) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// We can't return here because the `-nonexistent` rule is a bit\r\n\t\t// complicated in terms of what trumps it. We don't want e.g.\r\n\t\t// +Mythical to unban Shaymin in Gen 1, for instance.\r\n\t\tlet nonexistentCheck = Tags.nonexistent.genericFilter!(tierSpecies) && ruleTable.check('nonexistent');\r\n\r\n\t\tconst EXISTENCE_TAG = ['past', 'future', 'lgpe', 'unobtainable', 'cap', 'custom', 'nonexistent'];\r\n\r\n\t\tfor (const ruleid of ruleTable.tagRules) {\r\n\t\t\tif (ruleid.startsWith('*')) continue;\r\n\t\t\tconst tagid = ruleid.slice(12);\r\n\t\t\tconst tag = Tags[tagid];\r\n\t\t\tif ((tag.speciesFilter || tag.genericFilter)!(tierSpecies)) {\r\n\t\t\t\tconst existenceTag = EXISTENCE_TAG.includes(tagid);\r\n\t\t\t\tif (ruleid.startsWith('+')) {\r\n\t\t\t\t\t// we want rules like +CAP to trump -Nonexistent, but most tags shouldn't\r\n\t\t\t\t\tif (!existenceTag && nonexistentCheck) continue;\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tif (existenceTag) {\r\n\t\t\t\t\t// for a nicer error message\r\n\t\t\t\t\tnonexistentCheck = 'banned';\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${species.name} is tagged ${tag.name}, which is ${ruleTable.check(ruleid.slice(1)) || \"banned\"}.`;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (nonexistentCheck) {\r\n\t\t\tif (tierSpecies.isNonstandard === 'Past' || tierSpecies.isNonstandard === 'Future') {\r\n\t\t\t\treturn `${tierSpecies.name} does not exist in Gen ${dex.gen}.`;\r\n\t\t\t}\r\n\t\t\tif (tierSpecies.isNonstandard === 'LGPE') {\r\n\t\t\t\treturn `${tierSpecies.name} does not exist in this game, only in Let's Go Pikachu/Eevee.`;\r\n\t\t\t}\r\n\t\t\tif (tierSpecies.isNonstandard === 'CAP') {\r\n\t\t\t\treturn `${tierSpecies.name} is a CAP and does not exist in this game.`;\r\n\t\t\t}\r\n\t\t\tif (tierSpecies.isNonstandard === 'Unobtainable') {\r\n\t\t\t\treturn `${tierSpecies.name} is not possible to obtain in this game.`;\r\n\t\t\t}\r\n\t\t\tif (tierSpecies.isNonstandard === 'Gigantamax') {\r\n\t\t\t\treturn `${tierSpecies.name} is a placeholder for a Gigantamax sprite, not a real Pok\u00E9mon. (This message is likely to be a validator bug.)`;\r\n\t\t\t}\r\n\t\t\treturn `${tierSpecies.name} does not exist in this game.`;\r\n\t\t}\r\n\t\tif (nonexistentCheck === '') return null;\r\n\r\n\t\t// Special casing for Pokemon that can Gmax, but their Gmax factor cannot be legally obtained\r\n\t\tif (tierSpecies.gmaxUnreleased && set.gigantamax) {\r\n\t\t\tbanReason = ruleTable.check('pokemontag:unobtainable');\r\n\t\t\tif (banReason) {\r\n\t\t\t\treturn `${tierSpecies.name} is flagged as gigantamax, but it cannot gigantamax without hacking or glitches.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\tbanReason = ruleTable.check('pokemontag:allpokemon');\r\n\t\tif (banReason) {\r\n\t\t\treturn `${species.name} is not in the list of allowed pokemon.`;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcheckItem(set: PokemonSet, item: Item, setHas: {[k: string]: true}) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\tsetHas['item:' + item.id] = true;\r\n\r\n\t\tlet banReason = ruleTable.check('item:' + (item.id || 'noitem'));\r\n\t\tif (banReason) {\r\n\t\t\tif (!item.id) {\r\n\t\t\t\treturn `${set.name} not holding an item is ${banReason}.`;\r\n\t\t\t}\r\n\t\t\treturn `${set.name}'s item ${item.name} is ${banReason}.`;\r\n\t\t}\r\n\t\tif (banReason === '') return null;\r\n\r\n\t\tif (!item.id) return null;\r\n\r\n\t\tbanReason = ruleTable.check('pokemontag:allitems');\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s item ${item.name} is not in the list of allowed items.`;\r\n\t\t}\r\n\r\n\t\t// obtainability\r\n\t\tif (item.isNonstandard) {\r\n\t\t\tbanReason = ruleTable.check('pokemontag:' + toID(item.isNonstandard));\r\n\t\t\tif (banReason) {\r\n\t\t\t\tif (item.isNonstandard === 'Unobtainable') {\r\n\t\t\t\t\treturn `${item.name} is not obtainable without hacking or glitches.`;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${set.name}'s item ${item.name} is tagged ${item.isNonstandard}, which is ${banReason}.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\tif (item.isNonstandard && item.isNonstandard !== 'Unobtainable') {\r\n\t\t\tbanReason = ruleTable.check('nonexistent', setHas);\r\n\t\t\tif (banReason) {\r\n\t\t\t\tif (['Past', 'Future'].includes(item.isNonstandard)) {\r\n\t\t\t\t\treturn `${set.name}'s item ${item.name} does not exist in Gen ${dex.gen}.`;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${set.name}'s item ${item.name} does not exist in this game.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcheckMove(set: PokemonSet, move: Move, setHas: {[k: string]: true}) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\tsetHas['move:' + move.id] = true;\r\n\r\n\t\tlet banReason = ruleTable.check('move:' + move.id);\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s move ${move.name} is ${banReason}.`;\r\n\t\t}\r\n\t\tif (banReason === '') return null;\r\n\r\n\t\tbanReason = ruleTable.check('pokemontag:allmoves');\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s move ${move.name} is not in the list of allowed moves.`;\r\n\t\t}\r\n\r\n\t\t// obtainability\r\n\t\tif (move.isNonstandard) {\r\n\t\t\tbanReason = ruleTable.check('pokemontag:' + toID(move.isNonstandard));\r\n\t\t\tif (banReason) {\r\n\t\t\t\tif (move.isNonstandard === 'Unobtainable') {\r\n\t\t\t\t\treturn `${move.name} is not obtainable without hacking or glitches${dex.gen >= 9 && move.gen < dex.gen ? ` in Gen ${dex.gen}` : ``}.`;\r\n\t\t\t\t}\r\n\t\t\t\tif (move.isNonstandard === 'Gigantamax') {\r\n\t\t\t\t\treturn `${move.name} is not usable without Gigantamaxing its user, ${move.isMax}.`;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${set.name}'s move ${move.name} is tagged ${move.isNonstandard}, which is ${banReason}.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\tif (move.isNonstandard && move.isNonstandard !== 'Unobtainable') {\r\n\t\t\tbanReason = ruleTable.check('nonexistent', setHas);\r\n\t\t\tif (banReason) {\r\n\t\t\t\tif (['Past', 'Future'].includes(move.isNonstandard)) {\r\n\t\t\t\t\treturn `${set.name}'s move ${move.name} does not exist in Gen ${dex.gen}.`;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${set.name}'s move ${move.name} does not exist in this game.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcheckAbility(set: PokemonSet, ability: Ability, setHas: {[k: string]: true}) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\tsetHas['ability:' + ability.id] = true;\r\n\r\n\t\tif (this.format.id.startsWith('gen9pokebilities')) {\r\n\t\t\tconst species = dex.species.get(set.species);\r\n\t\t\tconst unSeenAbilities = Object.keys(species.abilities)\r\n\t\t\t\t.filter(key => key !== 'S' && (key !== 'H' || !species.unreleasedHidden))\r\n\t\t\t\t.map(key => species.abilities[key as \"0\" | \"1\" | \"H\" | \"S\"]);\r\n\r\n\t\t\tif (ability.id !== this.toID(species.abilities['S'])) {\r\n\t\t\t\tfor (const abilityName of unSeenAbilities) {\r\n\t\t\t\t\tsetHas['ability:' + toID(abilityName)] = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet banReason = ruleTable.check('ability:' + ability.id);\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s ability ${ability.name} is ${banReason}.`;\r\n\t\t}\r\n\t\tif (banReason === '') return null;\r\n\r\n\t\tbanReason = ruleTable.check('pokemontag:allabilities');\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s ability ${ability.name} is not in the list of allowed abilities.`;\r\n\t\t}\r\n\r\n\t\t// obtainability\r\n\t\tif (ability.isNonstandard) {\r\n\t\t\tbanReason = ruleTable.check('pokemontag:' + toID(ability.isNonstandard));\r\n\t\t\tif (banReason) {\r\n\t\t\t\treturn `${set.name}'s ability ${ability.name} is tagged ${ability.isNonstandard}, which is ${banReason}.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\r\n\t\t\tbanReason = ruleTable.check('nonexistent', setHas);\r\n\t\t\tif (banReason) {\r\n\t\t\t\tif (['Past', 'Future'].includes(ability.isNonstandard)) {\r\n\t\t\t\t\treturn `${set.name}'s ability ${ability.name} does not exist in Gen ${dex.gen}.`;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${set.name}'s ability ${ability.name} does not exist in this game.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcheckNature(set: PokemonSet, nature: Nature, setHas: {[k: string]: true}) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\tsetHas['nature:' + nature.id] = true;\r\n\r\n\t\tlet banReason = ruleTable.check('nature:' + nature.id);\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s nature ${nature.name} is ${banReason}.`;\r\n\t\t}\r\n\t\tif (banReason === '') return null;\r\n\r\n\t\tbanReason = ruleTable.check('allnatures');\r\n\t\tif (banReason) {\r\n\t\t\treturn `${set.name}'s nature ${nature.name} is not in the list of allowed natures.`;\r\n\t\t}\r\n\r\n\t\t// obtainability\r\n\t\tif (nature.isNonstandard) {\r\n\t\t\tbanReason = ruleTable.check('pokemontag:' + toID(nature.isNonstandard));\r\n\t\t\tif (banReason) {\r\n\t\t\t\treturn `${set.name}'s nature ${nature.name} is tagged ${nature.isNonstandard}, which is ${banReason}.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\r\n\t\t\tbanReason = ruleTable.check('nonexistent', setHas);\r\n\t\t\tif (banReason) {\r\n\t\t\t\tif (['Past', 'Future'].includes(nature.isNonstandard)) {\r\n\t\t\t\t\treturn `${set.name}'s nature ${nature.name} does not exist in Gen ${dex.gen}.`;\r\n\t\t\t\t}\r\n\t\t\t\treturn `${set.name}'s nature ${nature.name} does not exist in this game.`;\r\n\t\t\t}\r\n\t\t\tif (banReason === '') return null;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvalidateEvent(\r\n\t\tset: PokemonSet, setSources: PokemonSources, eventData: EventInfo, eventSpecies: Species\r\n\t): true | undefined;\r\n\tvalidateEvent(\r\n\t\tset: PokemonSet, setSources: PokemonSources, eventData: EventInfo, eventSpecies: Species,\r\n\t\tbecause: string, from?: string\r\n\t): string[] | undefined;\r\n\t/**\r\n\t * Returns array of error messages if invalid, undefined if valid\r\n\t *\r\n\t * If `because` is not passed, instead returns true if invalid.\r\n\t */\r\n\tvalidateEvent(\r\n\t\tset: PokemonSet, setSources: PokemonSources, eventData: EventInfo, eventSpecies: Species,\r\n\t\tbecause = ``, from = `from an event`\r\n\t) {\r\n\t\tconst dex = this.dex;\r\n\t\tlet name = set.species;\r\n\t\tconst species = dex.species.get(set.species);\r\n\t\tconst maxSourceGen = this.ruleTable.has('allowtradeback') ? Utils.clampIntRange(dex.gen + 1, 1, 8) : dex.gen;\r\n\t\tif (!eventSpecies) eventSpecies = species;\r\n\t\tif (set.name && set.species !== set.name && species.baseSpecies !== set.name) name = `${set.name} (${set.species})`;\r\n\r\n\t\tconst fastReturn = !because;\r\n\t\tif (eventData.from) from = `from ${eventData.from}`;\r\n\t\tconst etc = `${because} ${from}`;\r\n\r\n\t\tconst problems = [];\r\n\r\n\t\tif (dex.gen < 8 && this.minSourceGen > eventData.generation) {\r\n\t\t\tif (fastReturn) return true;\r\n\t\t\tproblems.push(`This format requires Pokemon from gen ${this.minSourceGen} or later and ${name} is from gen ${eventData.generation}${etc}.`);\r\n\t\t}\r\n\t\tif (maxSourceGen < eventData.generation) {\r\n\t\t\tif (fastReturn) return true;\r\n\t\t\tproblems.push(`This format is in gen ${dex.gen} and ${name} is from gen ${eventData.generation}${etc}.`);\r\n\t\t}\r\n\r\n\t\tif (eventData.japan && dex.currentMod !== 'gen1jpn') {\r\n\t\t\tif (fastReturn) return true;\r\n\t\t\tproblems.push(`${name} has moves from Japan-only events, but this format simulates International Yellow/Crystal which can't trade with Japanese games.`);\r\n\t\t}\r\n\r\n\t\tif (eventData.level && (set.level || 0) < eventData.level) {\r\n\t\t\tif (fastReturn) return true;\r\n\t\t\tproblems.push(`${name} must be at least level ${eventData.level}${etc}.`);\r\n\t\t}\r\n\t\tif ((eventData.shiny === true && !set.shiny) || (!eventData.shiny && set.shiny)) {\r\n\t\t\tif (fastReturn) return true;\r\n\t\t\tconst shinyReq = eventData.shiny ? ` be shiny` : ` not be shiny`;\r\n\t\t\tproblems.push(`${name} must${shinyReq}${etc}.`);\r\n\t\t}\r\n\t\tif (eventData.gender) {\r\n\t\t\tif (set.gender && eventData.gender !== set.gender) {\r\n\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\tproblems.push(`${name}'s gender must be ${eventData.gender}${etc}.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst canMint = dex.gen > 7;\r\n\t\tif (eventData.nature && eventData.nature !== set.nature && !canMint) {\r\n\t\t\tif (fastReturn) return true;\r\n\t\t\tproblems.push(`${name} must have a ${eventData.nature} nature${etc} - Mints are only available starting gen 8.`);\r\n\t\t}\r\n\t\tlet requiredIVs = 0;\r\n\t\tif (eventData.ivs) {\r\n\t\t\t/** In Gen 7+, IVs can be changed to 31 */\r\n\t\t\tconst canBottleCap = dex.gen >= 7 && set.level >= (dex.gen < 9 ? 100 : 50);\r\n\r\n\t\t\tif (!set.ivs) set.ivs = {hp: 31, atk: 31, def: 31, spa: 31, spd: 31, spe: 31};\r\n\t\t\tlet statName: StatID;\r\n\t\t\tfor (statName in eventData.ivs) {\r\n\t\t\t\tif (canBottleCap && set.ivs[statName] === 31) continue;\r\n\t\t\t\tif (set.ivs[statName] !== eventData.ivs[statName]) {\r\n\t\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\t\tproblems.push(`${name} must have ${eventData.ivs[statName]} ${Dex.stats.names[statName]} IVs${etc}.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (canBottleCap) {\r\n\t\t\t\t// IVs can be overridden but Hidden Power type can't\r\n\t\t\t\tif (Object.keys(eventData.ivs).length >= 6) {\r\n\t\t\t\t\tconst requiredHpType = dex.getHiddenPower(eventData.ivs).type;\r\n\t\t\t\t\tif (set.hpType && set.hpType !== requiredHpType) {\r\n\t\t\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\t\t\tproblems.push(`${name} can only have Hidden Power ${requiredHpType}${etc}.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tset.hpType = requiredHpType;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\trequiredIVs = eventData.perfectIVs || 0;\r\n\t\t}\r\n\t\tif (requiredIVs && set.ivs) {\r\n\t\t\t// Legendary Pokemon must have at least 3 perfect IVs in gen 6\r\n\t\t\t// Events can also have a certain amount of guaranteed perfect IVs\r\n\t\t\tlet perfectIVs = 0;\r\n\t\t\tlet statName: StatID;\r\n\t\t\tfor (statName in set.ivs) {\r\n\t\t\t\tif (set.ivs[statName] >= 31) perfectIVs++;\r\n\t\t\t}\r\n\t\t\tif (perfectIVs < requiredIVs) {\r\n\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\tif (eventData.perfectIVs) {\r\n\t\t\t\t\tproblems.push(`${name} must have at least ${requiredIVs} perfect IVs${etc}.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// The perfect IV count affects Hidden Power availability\r\n\t\t\tif (dex.gen >= 3 && requiredIVs >= 3 && set.hpType === 'Fighting') {\r\n\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\tproblems.push(`${name} can't use Hidden Power Fighting because it must have at least three perfect IVs${etc}.`);\r\n\t\t\t} else if (dex.gen >= 3 && requiredIVs >= 5 && set.hpType &&\r\n\t\t\t\t\t!['Dark', 'Dragon', 'Electric', 'Steel', 'Ice'].includes(set.hpType)) {\r\n\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\tproblems.push(`${name} can only use Hidden Power Dark/Dragon/Electric/Steel/Ice because it must have at least 5 perfect IVs${etc}.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst ruleTable = this.ruleTable;\r\n\t\tif (ruleTable.has('obtainablemoves')) {\r\n\t\t\tconst ssMaxSourceGen = setSources.maxSourceGen();\r\n\t\t\tconst tradebackEligible = dex.gen === 2 && (species.gen === 1 || eventSpecies.gen === 1);\r\n\t\t\tif (ssMaxSourceGen && eventData.generation > ssMaxSourceGen && !tradebackEligible) {\r\n\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\tproblems.push(`${name} must not have moves only learnable in gen ${ssMaxSourceGen}${etc}.`);\r\n\t\t\t}\r\n\r\n\t\t\tif (eventData.from === \"Gen 5 Dream World\" && setSources.dreamWorldMoveCount > 1) {\r\n\t\t\t\tproblems.push(`${name} can only have one Dream World move.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (ruleTable.has('obtainableabilities')) {\r\n\t\t\tif (dex.gen <= 5 && eventData.abilities && eventData.abilities.length === 1 && !eventData.isHidden) {\r\n\t\t\t\tif (species.name === eventSpecies.name) {\r\n\t\t\t\t\t// has not evolved, abilities must match\r\n\t\t\t\t\tconst requiredAbility = dex.abilities.get(eventData.abilities[0]).name;\r\n\t\t\t\t\tif (set.ability !== requiredAbility) {\r\n\t\t\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\t\t\tproblems.push(`${name} must have ${requiredAbility}${etc}.`);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// has evolved\r\n\t\t\t\t\tconst ability1 = dex.abilities.get(eventSpecies.abilities['1']);\r\n\t\t\t\t\tif (ability1.gen && eventData.generation >= ability1.gen) {\r\n\t\t\t\t\t\t// pokemon had 2 available abilities in the gen the event happened\r\n\t\t\t\t\t\t// ability is restricted to a single ability slot\r\n\t\t\t\t\t\tconst requiredAbilitySlot = (toID(eventData.abilities[0]) === ability1.id ? 1 : 0);\r\n\t\t\t\t\t\tconst requiredAbility = dex.abilities.get(species.abilities[requiredAbilitySlot] || species.abilities['0']).name;\r\n\t\t\t\t\t\tif (set.ability !== requiredAbility) {\r\n\t\t\t\t\t\t\tconst originalAbility = dex.abilities.get(eventData.abilities[0]).name;\r\n\t\t\t\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\t\t\t\tproblems.push(`${name} must have ${requiredAbility}${because} from a ${originalAbility} ${eventSpecies.name} event.`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (species.abilities['H']) {\r\n\t\t\t\tconst isHidden = (set.ability === species.abilities['H']);\r\n\t\t\t\tif (!isHidden && eventData.isHidden && dex.gen <= 8) {\r\n\t\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\t\tproblems.push(`${name} must have its Hidden Ability${etc}.`);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst canUseAbilityPatch = dex.gen >= 8 && this.format.mod !== 'gen8dlc1';\r\n\t\t\t\tif (isHidden && !eventData.isHidden && !canUseAbilityPatch) {\r\n\t\t\t\t\tif (fastReturn) return true;\r\n\t\t\t\t\tproblems.push(`${name} must not have its Hidden Ability${etc}.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (problems.length) return problems;\r\n\t\tif (eventData.gender) set.gender = eventData.gender;\r\n\t}\r\n\r\n\tallSources(species?: Species) {\r\n\t\tlet minSourceGen = this.minSourceGen;\r\n\t\tif (this.dex.gen >= 3 && minSourceGen < 3) minSourceGen = 3;\r\n\t\tif (species) minSourceGen = Math.max(minSourceGen, species.gen);\r\n\t\tconst maxSourceGen = this.ruleTable.has('allowtradeback') ? Utils.clampIntRange(this.dex.gen + 1, 1, 8) : this.dex.gen;\r\n\t\treturn new PokemonSources(maxSourceGen, minSourceGen);\r\n\t}\r\n\r\n\tvalidateMoves(\r\n\t\tspecies: Species, moves: string[], setSources: PokemonSources, set?: Partial<PokemonSet>,\r\n\t\tname: string = species.name, moveLegalityWhitelist: {[k: string]: true | undefined} = {}\r\n\t) {\r\n\t\tconst dex = this.dex;\r\n\t\tconst ruleTable = this.ruleTable;\r\n\r\n\t\tconst problems = [];\r\n\r\n\t\tconst checkCanLearn = (ruleTable.checkCanLearn?.[0] || this.checkCanLearn);\r\n\t\tfor (const moveName of moves) {\r\n\t\t\tconst move = dex.moves.get(moveName);\r\n\t\t\tif (moveLegalityWhitelist[move.id]) continue;\r\n\t\t\tconst problem = checkCanLearn.call(this, move, species, setSources, set);\r\n\t\t\tif (problem) {\r\n\t\t\t\tproblems.push(`${name}${problem}`);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (setSources.size() && setSources.moveEvoCarryCount > 3) {\r\n\t\t\tif (setSources.sourcesBefore < 6) setSources.sourcesBefore = 0;\r\n\t\t\tsetSources.sources = setSources.sources.filter(\r\n\t\t\t\tsource => source.charAt(1) === 'E' && parseInt(source.charAt(0)) >= 6\r\n\t\t\t);\r\n\t\t\tif (!setSources.size()) {\r\n\t\t\t\tproblems.push(`${name} needs to know ${species.evoMove || 'a Fairy-type move'} to evolve, so it can only know 3 other moves from ${species.prevo}.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (problems.length) return problems;\r\n\r\n\t\tif (setSources.isHidden) {\r\n\t\t\tsetSources.sources = setSources.sources.filter(\r\n\t\t\t\tsource => parseInt(source.charAt(0)) >= 5\r\n\t\t\t);\r\n\t\t\tif (setSources.sourcesBefore < 5) setSources.sourcesBefore = 0;\r\n\t\t\tconst canUseAbilityPatch = dex.gen >= 8 && this.format.mod !== 'gen8dlc1';\r\n\t\t\tif (!setSources.size() && !canUseAbilityPatch) {\r\n\t\t\t\tproblems.push(`${name} has a hidden ability - it can't have moves only learned before gen 5.`);\r\n\t\t\t\treturn problems;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (setSources.babyOnly && setSources.sources.length) {\r\n\t\t\tconst baby = dex.species.get(setSources.babyOnly);\r\n\t\t\tconst babyEvo = toID(baby.evos[0]);\r\n\t\t\tsetSources.sources = setSources.sources.filter(source => {\r\n\t\t\t\tif (source.charAt(1) === 'S') {\r\n\t\t\t\t\tconst sourceId = source.split(' ')[1];\r\n\t\t\t\t\tif (sourceId !== baby.id) return false;\r\n\t\t\t\t}\r\n\t\t\t\tif (source.charAt(1) === 'E') {\r\n\t\t\t\t\tif (babyEvo && source.slice(2) === babyEvo) return false;\r\n\t\t\t\t}\r\n\t\t\t\tif (source.charAt(1) === 'D') {\r\n\t\t\t\t\tif (babyEvo && source.slice(2) === babyEvo) return false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tif (!setSources.size()) {\r\n\t\t\t\tproblems.push(`${name}'s event/egg moves are from an evolution, and are incompatible with its moves from ${baby.name}.`);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (setSources.babyOnly && setSources.size() && this.gen > 2) {\r\n\t\t\t// there do theoretically exist evo/tradeback incompatibilities in\r\n\t\t\t// gen 2, but those are very complicated to validate and should be\r\n\t\t\t// handled separately anyway, so for now we just treat them all as\r\n\t\t\t// legal (competitively relevant ones can be manually banned)\r\n\t\t\tconst baby = dex.species.get(setSources.babyOnly);\r\n\t\t\tsetSources.sources = setSources.sources.filter(source => {\r\n\t\t\t\tif (baby.gen > parseInt(source.charAt(0)) && !source.startsWith('1ST')) return false;\r\n\t\t\t\tif (baby.gen > 2 && source === '7V') return false;\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tif (setSources.sourcesBefore < baby.gen) setSources.sourcesBefore = 0;\r\n\t\t\tif (!setSources.size()) {\r\n\t\t\t\tproblems.push(`${name} has moves from before Gen ${baby.gen}, which are incompatible with its moves from ${baby.name}.`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn problems;\r\n\t}\r\n\t/**\r\n\t * Returns a list of problems regarding a Pokemon's avilability in Pokemon GO (empty list if no problems)\r\n\t * If the Pokemon cannot be obtained from Pokemon GO, returns null\r\n\t */\r\n\tvalidatePokemonGo(\r\n\t\tspecies: Species, set: Partial<PokemonSet>, setSources: PokemonSources, name: string = species.name,\r\n\t): string[] | null {\r\n\t\tlet problems = [];\r\n\t\tlet minLevel = 50; // maximum level a Pokemon can be in Pokemon GO\r\n\t\tlet minIVs = 15; // IVs range from 0 to 15 in Pokemon GO\r\n\t\tconst dex = this.dex;\r\n\t\tconst pokemonGoData = dex.species.getPokemonGoData(species.id);\r\n\t\tif (dex.gen < 8 || this.format.mod === 'gen8dlc1') return null;\r\n\t\tif (!pokemonGoData) {\r\n\t\t\t// Handles forms and evolutions not obtainable from Pokemon GO\r\n\t\t\tconst otherSpecies = this.dex.species.learnsetParent(species);\r\n\t\t\t// If a Pokemon is somehow not obtainable from Pokemon GO and it must be leveled up to be evolved,\r\n\t\t\t// validation for the game should stop because it's more optimal to get the Pokemon outside of the game\r\n\t\t\tif (otherSpecies && !species.evoLevel) {\r\n\t\t\t\tconst otherProblems = this.validatePokemonGo(otherSpecies, set, setSources, name);\r\n\t\t\t\tif (otherProblems) {\r\n\t\t\t\t\tproblems = otherProblems;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst pokemonGoSources = pokemonGoData.encounters;\r\n\t\t\t// should never happen\r\n\t\t\tif (!pokemonGoSources) throw new Error(`Species with no Pokemon GO data: ${species.id}`);\r\n\t\t\tif (set.shiny) name = \"Shiny \" + name;\r\n\t\t\tif (set.shiny && pokemonGoSources.includes('noshiny')) {\r\n\t\t\t\tproblems.push(`${name} is not obtainable from Pokemon GO.`);\r\n\t\t\t} else {\r\n\t\t\t\tif (pokemonGoSources.includes('wild') && !((set.shiny && pokemonGoSources.includes('nowildshiny')))) {\r\n\t\t\t\t\tminLevel = 1;\r\n\t\t\t\t\tminIVs = 0;\r\n\t\t\t\t}\r\n\t\t\t\tif (pokemonGoSources.includes('egg')) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * A Pokemon's level when hatched is determined by the trainer's level when it is obtained\r\n\t\t\t\t\t * It is no longer possible for new accounts to obtain eggs at level 1 because they will have reached\r\n\t\t\t\t\t * level 2 by the time they can spin a PokeStop. However, it might be possible for a sleeper account\r\n\t\t\t\t\t * from before XP changes to get a level 1 egg from spinning a PokeStop that sends the account to\r\n\t\t\t\t\t * level 2, but this needs research\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tminLevel = Math.min(minLevel, 2);\r\n\t\t\t\t\tminIVs = Math.min(minIVs, 10);\r\n\t\t\t\t}\r\n\t\t\t\tif (pokemonGoSources.includes('12kmegg')) {\r\n\t\t\t\t\tminLevel = Math.min(minLevel, 8);\r\n\t\t\t\t\tminIVs = Math.min(minIVs, 10);\r\n\t\t\t\t}\r\n\t\t\t\tif (pokemonGoSources.includes('raid')) {\r\n\t\t\t\t\tminLevel = Math.min(minLevel, 20);\r\n\t\t\t\t\tminIVs = Math.min(minIVs, 10);\r\n\t\t\t\t}\r\n\t\t\t\tif (species.id === 'mewtwo' && set.level && set.level >= 20) {\r\n\t\t\t\t\t// A bug allowed Mewtwo to be encountered with an IV floor of 0 from GO Battle League\r\n\t\t\t\t\tminIVs = Math.min(minIVs, 0);\r\n\t\t\t\t}\r\n\t\t\t\tif (pokemonGoSources.includes('research')) {\r\n\t\t\t\t\tminLevel = Math.min(minLevel, 15);\r\n\t\t\t\t\tminIVs = Math.min(minIVs, 10);\r\n\t\t\t\t}\r\n\t\t\t\tif (pokemonGoSources.includes('giovanni') && !set.shiny) {\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * Purified Pokemon can be leveled down to level 8 after trading; they are forced to\r\n\t\t\t\t\t * special trades, but currently all Giovanni Shadow Pokemon are already forced special trades\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tminLevel = Math.min(minLevel, 8);\r\n\t\t\t\t\tminIVs = Math.min(minIVs, 1);\r\n\t\t\t\t\tif (set.level && set.level < 12) setSources.pokemonGoSource = \"purified\";\r\n\t\t\t\t}\r\n\t\t\t\t// Attempt to trade the Pokemon to reduce level and IVs\r\n\t\t\t\tif (!pokemonGoSources.includes('notrade')) {\r\n\t\t\t\t\t// Special trades require a good friend\r\n\t\t\t\t\t// Trading with a friend of this level has an IV floor of 1\r\n\t\t\t\t\t// Note that (non-shiny) Deoxys could be traded for a short time when it was introduced\r\n\t\t\t\t\tif (!set.shiny || species.id !== 'deoxys') {\r\n\t\t\t\t\t\tconst specialTrade = pokemonGoSources.includes('specialtrade') || set.shiny;\r\n\t\t\t\t\t\tminLevel = Math.min(minLevel, 12);\r\n\t\t\t\t\t\tminIVs = Math.min(minIVs, specialTrade ? 1 : 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (set.level && set.level < minLevel) {\r\n\t\t\t\t\tproblems.push(`${name} must be at least level ${minLevel} to be from Pokemon GO.`);\r\n\t\t\t\t}\r\n\t\t\t\tconst ivs = set.ivs || TeamValidator.fillStats(null, 31);\r\n\t\t\t\tfor (const stat in ivs) {\r\n\t\t\t\t\tif (Math.floor(ivs[stat as 'hp'] / 2) < minIVs && stat !== 'spe') {\r\n\t\t\t\t\t\tproblems.push(`${name} must have at least ${minIVs} ` +\r\n\t\t\t\t\t\t(minIVs === 1 ? `IV` : `IVs`) + ` in non-Speed stats to be from Pokemon GO.`);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn problems;\r\n\t}\r\n\r\n\tomCheckCanLearn(\r\n\t\tmove: Move,\r\n\t\ts: Species,\r\n\t\tsetSources = this.allSources(s),\r\n\t\tset: Partial<PokemonSet> = {},\r\n\t\tproblem = `${set.name || s.name} can't learn ${move.name}`,\r\n\t): string | null {\r\n\t\tif (!this.ruleTable.checkCanLearn?.[0]) return problem;\r\n\t\tconst baseCheckCanLearn = this.checkCanLearn;\r\n\t\t// tell the custom move legality check that the move is illegal by default\r\n\t\tthis.checkCanLearn = () => problem;\r\n\t\tconst omVerdict = this.ruleTable.checkCanLearn[0].call(this, move, s, setSources, set);\r\n\t\tthis.checkCanLearn = baseCheckCanLearn;\r\n\t\treturn omVerdict;\r\n\t}\r\n\r\n\t/** Returns null if you can learn the move, or a string explaining why you can't learn it */\r\n\tcheckCanLearn(\r\n\t\tmove: Move,\r\n\t\toriginalSpecies: Species,\r\n\t\tsetSources = this.allSources(originalSpecies),\r\n\t\tset: Partial<PokemonSet> = {}\r\n\t): string | null {\r\n\t\tconst dex = this.dex;\r\n\t\tif (!setSources.size()) throw new Error(`Bad sources passed to checkCanLearn`);\r\n\r\n\t\tmove = dex.moves.get(move);\r\n\t\tconst moveid = move.id;\r\n\t\tconst baseSpecies = dex.species.get(originalSpecies);\r\n\r\n\t\tconst format = this.format;\r\n\t\tconst ruleTable = dex.formats.getRuleTable(format);\r\n\t\tconst level = set.level || 100;\r\n\r\n\t\tlet cantLearnReason = null;\r\n\r\n\t\tlet limit1 = true;\r\n\t\tlet sketch = false;\r\n\t\tlet blockedHM = false;\r\n\r\n\t\tlet babyOnly = '';\r\n\r\n\t\t// This is a pretty complicated algorithm\r\n\r\n\t\t// Abstractly, what it does is construct the union of sets of all\r\n\t\t// possible ways this pokemon could be obtained, and then intersect\r\n\t\t// it with a the pokemon's existing set of all possible ways it could\r\n\t\t// be obtained. If this intersection is non-empty, the move is legal.\r\n\r\n\t\t// set of possible sources of a pokemon with this move\r\n\t\tconst moveSources = new PokemonSources();\r\n\r\n\t\t/**\r\n\t\t * The format doesn't allow Pokemon traded from the future\r\n\t\t * (This is everything except in Gen 1 Tradeback)\r\n\t\t */\r\n\t\tconst noFutureGen = !ruleTable.has('allowtradeback');\r\n\t\t/**\r\n\t\t * The format allows Sketch to copy moves in Gen 8\r\n\t\t */\r\n\t\tconst canSketchPostGen7Moves = ruleTable.has('sketchpostgen7moves') || this.dex.currentMod === 'gen8bdsp';\r\n\r\n\t\tlet tradebackEligible = false;\r\n\t\tconst fullLearnset = dex.species.getFullLearnset(originalSpecies.id);\r\n\t\tif (!fullLearnset.length) {\r\n\t\t\t// It's normal for a nonstandard species not to have learnset data\r\n\r\n\t\t\t// Formats should replace the `Obtainable Moves` rule if they want to\r\n\t\t\t// allow pokemon without learnsets.\r\n\t\t\treturn ` can't learn any moves at all.`;\r\n\t\t}\r\n\r\n\t\tfor (const {species, learnset} of fullLearnset) {\r\n\t\t\tif (dex.gen <= 2 && species.gen === 1) tradebackEligible = true;\r\n\t\t\tconst checkingPrevo = species.baseSpecies !== originalSpecies.baseSpecies;\r\n\t\t\tif (checkingPrevo && !moveSources.size()) {\r\n\t\t\t\tif (!setSources.babyOnly || !species.prevo) {\r\n\t\t\t\t\tbabyOnly = species.id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet sources = learnset[moveid] || [];\r\n\t\t\tif (moveid === 'sketch') {\r\n\t\t\t\tsketch = true;\r\n\t\t\t} else if (learnset['sketch']) {\r\n\t\t\t\tif (move.noSketch || move.isZ || move.isMax) {\r\n\t\t\t\t\tcantLearnReason = `can't be Sketched.`;\r\n\t\t\t\t} else if (move.gen > 7 && !canSketchPostGen7Moves &&\r\n\t\t\t\t\t(dex.gen === 8 ||\r\n\t\t\t\t\t\t(dex.gen === 9 && ['gen9dlc1', 'gen9predlc'].includes(format.mod)))) {\r\n\t\t\t\t\tcantLearnReason = `can't be Sketched because it's a Gen ${move.gen} move and Sketch isn't available in Gen ${move.gen}.`;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!sources.length || !moveSources.size()) sketch = true;\r\n\t\t\t\t\tsources = [...learnset['sketch'], ...sources];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let learned of sources) {\r\n\t\t\t\t// Every `learned` represents a single way a pokemon might\r\n\t\t\t\t// learn a move. This can be handled one of several ways:\r\n\t\t\t\t// `continue`\r\n\t\t\t\t//   means we can't learn it\r\n\t\t\t\t// `return null`\r\n\t\t\t\t//   means we can learn it with no restrictions\r\n\t\t\t\t//   (there's a way to just teach any pokemon of this species\r\n\t\t\t\t//   the move in the current gen, like a TM.)\r\n\t\t\t\t// `moveSources.add(source)`\r\n\t\t\t\t//   means we can learn it only if obtained that exact way described\r\n\t\t\t\t//   in source\r\n\t\t\t\t// `moveSources.addGen(learnedGen)`\r\n\t\t\t\t//   means we can learn it only if obtained at or before learnedGen\r\n\t\t\t\t//   (i.e. get the pokemon however you want, transfer to that gen,\r\n\t\t\t\t//   teach it, and transfer it to the current gen.)\r\n\r\n\t\t\t\tconst learnedGen = parseInt(learned.charAt(0));\r\n\t\t\t\tif (learnedGen < this.minSourceGen) {\r\n\t\t\t\t\tif (!cantLearnReason) {\r\n\t\t\t\t\t\tcantLearnReason = `can't be transferred from Gen ${learnedGen} to ${this.minSourceGen}.`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (noFutureGen && learnedGen > dex.gen) {\r\n\t\t\t\t\tif (!cantLearnReason) {\r\n\t\t\t\t\t\tcantLearnReason = `can't be transferred from Gen ${learnedGen} to ${dex.gen}.`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// redundant\r\n\t\t\t\tif (learnedGen <= moveSources.sourcesBefore) continue;\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tbaseSpecies.evoRegion === 'Alola' && checkingPrevo && learnedGen >= 8 &&\r\n\t\t\t\t\t(dex.gen < 9 || learned.charAt(1) !== 'E')\r\n\t\t\t\t) {\r\n\t\t\t\t\tcantLearnReason = `is from a ${species.name} that can't be transferred to USUM to evolve into ${baseSpecies.name}.`;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst canUseAbilityPatch = dex.gen >= 8 && format.mod !== 'gen8dlc1';\r\n\t\t\t\tif (\r\n\t\t\t\t\tlearnedGen < 7 && setSources.isHidden && !canUseAbilityPatch &&\r\n\t\t\t\t\t!dex.mod('gen' + learnedGen).species.get(baseSpecies.name).abilities['H']\r\n\t\t\t\t) {\r\n\t\t\t\t\tcantLearnReason = `can only be learned in gens without Hidden Abilities.`;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst ability = dex.abilities.get(set.ability);\r\n\t\t\t\tif (dex.gen < 6 && ability.gen > learnedGen && !checkingPrevo) {\r\n\t\t\t\t\t// You can evolve a transfered mon to reroll for its new Ability.\r\n\t\t\t\t\tcantLearnReason = `is learned in gen ${learnedGen}, but the Ability ${ability.name} did not exist then.`;\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!species.isNonstandard) {\r\n\t\t\t\t\t// HMs can't be transferred\r\n\t\t\t\t\tif (dex.gen >= 4 && learnedGen <= 3 && [\r\n\t\t\t\t\t\t'cut', 'fly', 'surf', 'strength', 'flash', 'rocksmash', 'waterfall', 'dive',\r\n\t\t\t\t\t].includes(moveid)) {\r\n\t\t\t\t\t\tcantLearnReason = `can't be transferred from Gen 3 to 4 because it's an HM move.`;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (dex.gen >= 5 && learnedGen <= 4 && [\r\n\t\t\t\t\t\t'cut', 'fly', 'surf', 'strength', 'rocksmash', 'waterfall', 'rockclimb',\r\n\t\t\t\t\t].includes(moveid)) {\r\n\t\t\t\t\t\tcantLearnReason = `can't be transferred from Gen 4 to 5 because it's an HM move.`;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Defog and Whirlpool can't be transferred together\r\n\t\t\t\t\tif (dex.gen >= 5 && ['defog', 'whirlpool'].includes(moveid) && learnedGen <= 4) blockedHM = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (learned.charAt(1) === 'L') {\r\n\t\t\t\t\t// special checking for level-up moves\r\n\t\t\t\t\tif (level >= parseInt(learned.substr(2)) || learnedGen === 7) {\r\n\t\t\t\t\t\t// we're past the required level to learn it\r\n\t\t\t\t\t\t// (gen 7 level-up moves can be relearnered at any level)\r\n\t\t\t\t\t\t// falls through to LMT check below\r\n\t\t\t\t\t} else if (level >= 5 && learnedGen === 3 && species.canHatch) {\r\n\t\t\t\t\t\t// Pomeg Glitch\r\n\t\t\t\t\t\tlearned = learnedGen + 'Epomeg';\r\n\t\t\t\t\t} else if ((!species.gender || species.gender === 'F') &&\r\n\t\t\t\t\t\tlearnedGen >= 2 && species.canHatch && !setSources.isFromPokemonGo) {\r\n\t\t\t\t\t\t// available as egg move\r\n\t\t\t\t\t\tlearned = learnedGen + 'Eany';\r\n\t\t\t\t\t\t// falls through to E check below\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// this move is unavailable, skip it\r\n\t\t\t\t\t\tcantLearnReason = `is learned at level ${parseInt(learned.substr(2))}.`;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Gen 8+ egg moves can be taught to any pokemon from any source\r\n\t\t\t\tif (learnedGen >= 8 && learned.charAt(1) === 'E' && learned.slice(1) !== 'Eany' &&\r\n\t\t\t\t\tlearned.slice(1) !== 'Epomeg' || 'LMTR'.includes(learned.charAt(1))) {\r\n\t\t\t\t\tif (learnedGen === dex.gen && learned.charAt(1) !== 'R') {\r\n\t\t\t\t\t\t// current-gen level-up, TM or tutor moves:\r\n\t\t\t\t\t\t//   always available\r\n\t\t\t\t\t\tif (!(learnedGen >= 8 && learned.charAt(1) === 'E') && babyOnly) {\r\n\t\t\t\t\t\t\tif (setSources.isFromPokemonGo && species.evoLevel) {\r\n\t\t\t\t\t\t\t\tcantLearnReason = `is from a prevo, which is incompatible with its Pokemon GO origin.`;\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tsetSources.babyOnly = babyOnly;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!moveSources.moveEvoCarryCount) return null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// past-gen level-up, TM, or tutor moves:\r\n\t\t\t\t\t//   available as long as the source gen was or was before this gen\r\n\t\t\t\t\tif (learned.charAt(1) === 'R') {\r\n\t\t\t\t\t\tmoveSources.restrictedMove = moveid;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlimit1 = false;\r\n\t\t\t\t\tmoveSources.addGen(learnedGen);\r\n\t\t\t\t} else if (learned.charAt(1) === 'E') {\r\n\t\t\t\t\t// egg moves:\r\n\t\t\t\t\t//   only if hatched from an egg\r\n\t\t\t\t\tlet limitedEggMove: ID | null | undefined = undefined;\r\n\t\t\t\t\tif (learned.slice(1) === 'Eany') {\r\n\t\t\t\t\t\tif (species.gender === 'F') {\r\n\t\t\t\t\t\t\tlimitedEggMove = move.id;\r\n\t\t\t\t\t\t\tmoveSources.levelUpEggMoves = [move.id];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tlimitedEggMove = null;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (learned.slice(1) === 'Epomeg') {\r\n\t\t\t\t\t\t// Pomeg glitched moves have to be from an egg but since they aren't true egg moves,\r\n\t\t\t\t\t\t// there should be no breeding restrictions\r\n\t\t\t\t\t\tmoveSources.pomegEggMoves = [move.id];\r\n\t\t\t\t\t} else if (learnedGen < 6) {\r\n\t\t\t\t\t\tlimitedEggMove = move.id;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlearned = learnedGen + 'E' + (species.prevo ? species.id : '');\r\n\t\t\t\t\tif (tradebackEligible && learnedGen === 2 && move.gen <= 1) {\r\n\t\t\t\t\t\t// can tradeback\r\n\t\t\t\t\t\tmoveSources.add('1ET' + learned.slice(2), limitedEggMove);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmoveSources.add(learned, limitedEggMove);\r\n\t\t\t\t} else if (learned.charAt(1) === 'S') {\r\n\t\t\t\t\t// event moves:\r\n\t\t\t\t\t//   only if that was the source\r\n\t\t\t\t\t// Event Pok\u00E9mon:\r\n\t\t\t\t\t// \tAvailable as long as the past gen can get the Pok\u00E9mon and then trade it back.\r\n\t\t\t\t\tif (tradebackEligible && learnedGen === 2 && move.gen <= 1) {\r\n\t\t\t\t\t\t// can tradeback\r\n\t\t\t\t\t\tmoveSources.add('1ST' + learned.slice(2) + ' ' + species.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmoveSources.add(learned + ' ' + species.id);\r\n\t\t\t\t\tconst eventLearnset = dex.species.getLearnsetData(species.id);\r\n\t\t\t\t\tif (eventLearnset.eventData?.[parseInt(learned.charAt(2))].emeraldEventEgg && learnedGen === 3) {\r\n\t\t\t\t\t\tmoveSources.pomegEventEgg = learned + ' ' + species.id;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (learned.charAt(1) === 'D') {\r\n\t\t\t\t\t// DW moves:\r\n\t\t\t\t\t//   only if that was the source\r\n\t\t\t\t\tmoveSources.add(learned + species.id);\r\n\t\t\t\t\tmoveSources.dreamWorldMoveCount++;\r\n\t\t\t\t} else if (learned.charAt(1) === 'V' && this.minSourceGen < learnedGen) {\r\n\t\t\t\t\t// Virtual Console or Let's Go transfer moves:\r\n\t\t\t\t\t//   only if that was the source\r\n\t\t\t\t\tif (learned === '8V' && setSources.isFromPokemonGo && babyOnly && species.evoLevel) {\r\n\t\t\t\t\t\tcantLearnReason = `is from a prevo, which is incompatible with its Pokemon GO origin.`;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmoveSources.add(learned);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ruleTable.has('mimicglitch') && species.gen < 5) {\r\n\t\t\t\t// include the Mimic Glitch when checking this mon's learnset\r\n\t\t\t\tconst glitchMoves = ['metronome', 'copycat', 'transform', 'mimic', 'assist'];\r\n\t\t\t\tlet getGlitch = false;\r\n\t\t\t\tfor (const i of glitchMoves) {\r\n\t\t\t\t\tif (learnset[i]) {\r\n\t\t\t\t\t\tif (!(i === 'mimic' && dex.abilities.get(set.ability).gen === 4 && !species.prevo)) {\r\n\t\t\t\t\t\t\tgetGlitch = true;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (getGlitch) {\r\n\t\t\t\t\tmoveSources.addGen(4);\r\n\t\t\t\t\tif (move.gen < 5) {\r\n\t\t\t\t\t\tlimit1 = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!moveSources.size()) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t(species.evoType === 'levelMove' && species.evoMove !== move.name) ||\r\n\t\t\t\t\t(species.id === 'sylveon' && move.type !== 'Fairy')\r\n\t\t\t\t) {\r\n\t\t\t\t\tmoveSources.moveEvoCarryCount = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (limit1 && sketch) {\r\n\t\t\t// limit 1 sketch move\r\n\t\t\tif (setSources.sketchMove) {\r\n\t\t\t\treturn ` can't Sketch ${move.name} and ${setSources.sketchMove} because it can only Sketch 1 move.`;\r\n\t\t\t}\r\n\t\t\tsetSources.sketchMove = move.name;\r\n\t\t}\r\n\r\n\t\tif (blockedHM) {\r\n\t\t\t// Limit one of Defog/Whirlpool to be transferred\r\n\t\t\tif (setSources.hm) return ` can't simultaneously transfer Defog and Whirlpool from Gen 4 to 5.`;\r\n\t\t\tsetSources.hm = moveid;\r\n\t\t}\r\n\r\n\t\tif (!setSources.restrictiveMoves) {\r\n\t\t\tsetSources.restrictiveMoves = [];\r\n\t\t}\r\n\t\tsetSources.restrictiveMoves.push(move.name);\r\n\r\n\t\tconst checkedSpecies = babyOnly ? fullLearnset[fullLearnset.length - 1].species : baseSpecies;\r\n\t\tif (checkedSpecies && setSources.isFromPokemonGo &&\r\n\t\t\t(setSources.pokemonGoSource === 'purified' || checkedSpecies.id === 'mew')) {\r\n\t\t\t// Pokemon that cannot be sent from Pokemon GO to Let's Go can only access Let's Go moves through HOME\r\n\t\t\t// It can only obtain a chain of four level up moves and cannot have TM moves\r\n\t\t\tconst pokemonGoData = dex.species.getPokemonGoData(checkedSpecies.id);\r\n\t\t\tif (pokemonGoData.LGPERestrictiveMoves) {\r\n\t\t\t\tlet levelUpMoveCount = 0;\r\n\t\t\t\tconst restrictiveMovesToID = [];\r\n\t\t\t\tfor (const moveName of setSources.restrictiveMoves) {\r\n\t\t\t\t\trestrictiveMovesToID.push(toID(moveName));\r\n\t\t\t\t}\r\n\t\t\t\tfor (const restrictiveMove in pokemonGoData.LGPERestrictiveMoves) {\r\n\t\t\t\t\tconst moveLevel = pokemonGoData.LGPERestrictiveMoves[restrictiveMove];\r\n\t\t\t\t\tif (toID(move) === restrictiveMove) {\r\n\t\t\t\t\t\tif (!moveLevel) {\r\n\t\t\t\t\t\t\treturn `'s move ${move.name} is incompatible with its Pokemon GO origin.`;\r\n\t\t\t\t\t\t} else if (set.level && set.level < moveLevel) {\r\n\t\t\t\t\t\t\treturn ` must be at least level ${moveLevel} to learn ${move.name} due to its Pokemon GO origin.`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (levelUpMoveCount) levelUpMoveCount++;\r\n\t\t\t\t\tif (restrictiveMovesToID.includes(restrictiveMove)) {\r\n\t\t\t\t\t\tif (!levelUpMoveCount) {\r\n\t\t\t\t\t\t\tlevelUpMoveCount++;\r\n\t\t\t\t\t\t} else if (levelUpMoveCount > 4) {\r\n\t\t\t\t\t\t\treturn `'s moves ${(setSources.restrictiveMoves || []).join(', ')} are incompatible with its Pokemon GO origin.`;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Now that we have our list of possible sources, intersect it with the current list\r\n\t\tif (!moveSources.size()) {\r\n\t\t\tif (cantLearnReason) return `'s move ${move.name} ${cantLearnReason}`;\r\n\t\t\treturn ` can't learn ${move.name}.`;\r\n\t\t}\r\n\t\tconst eggSources = moveSources.sources.filter(source => source.charAt(1) === 'E');\r\n\t\tif (dex.gen >= 3 && eggSources.length && moveSources.limitedEggMoves === null && moveSources.sourcesBefore) {\r\n\t\t\tmoveSources.possiblyLimitedEggMoves = [toID(moveSources.sourcesBefore + move.id)];\r\n\t\t}\r\n\t\tconst backupSources = setSources.sources;\r\n\t\tconst backupSourcesBefore = setSources.sourcesBefore;\r\n\t\tsetSources.intersectWith(moveSources);\r\n\t\tif (!setSources.size()) {\r\n\t\t\t// pretend this pokemon didn't have this move:\r\n\t\t\t// prevents a crash if OMs override `checkCanLearn` to keep validating after an error\r\n\t\t\tsetSources.sources = backupSources;\r\n\t\t\tsetSources.sourcesBefore = backupSourcesBefore;\r\n\t\t\tif (setSources.isFromPokemonGo) return `'s move ${move.name} is incompatible with its Pokemon GO origin.`;\r\n\t\t\treturn `'s moves ${(setSources.restrictiveMoves || []).join(', ')} are incompatible.`;\r\n\t\t}\r\n\r\n\t\tif (babyOnly) setSources.babyOnly = babyOnly;\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic fillStats(stats: SparseStatsTable | null, fillNum = 0): StatsTable {\r\n\t\tconst filledStats: StatsTable = {hp: fillNum, atk: fillNum, def: fillNum, spa: fillNum, spd: fillNum, spe: fillNum};\r\n\t\tif (stats) {\r\n\t\t\tlet statName: StatID;\r\n\t\t\tfor (statName in filledStats) {\r\n\t\t\t\tconst stat = stats[statName];\r\n\t\t\t\tif (typeof stat === 'number') filledStats[statName] = stat;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn filledStats;\r\n\t}\r\n\r\n\tstatic get(format: string | Format) {\r\n\t\treturn new TeamValidator(format);\r\n\t}\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
